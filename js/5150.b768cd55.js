"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[5150],{5150:function(e,t,a){a.d(t,{A:function(){return D}});var r=a(6768),n=a(4232);const l={class:"echart-container"},o={key:0,class:"segment-container"},s={class:"segment-wrapper"};function i(e,t,a,i,c,d){const u=(0,r.g2)("ChartContainer");return(0,r.uX)(),(0,r.CE)("div",l,[d.internalShowToggles?((0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("div",s,[(0,r.Lk)("div",{class:(0,n.C4)(["segment-bg",c.viewMode])},null,2),(0,r.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"monthly"===c.viewMode}]),onClick:t[0]||(t[0]=e=>c.viewMode="monthly")},"月度",2),(0,r.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"yearly"===c.viewMode}]),onClick:t[1]||(t[1]=e=>c.viewMode="yearly")},"年度",2)])])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.chartsToRender,(e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,chart:e,returnData:a.returnData,config:a.config,viewMode:c.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}const c=e=>((0,r.Qi)("data-v-5325215c"),e=e(),(0,r.jt)(),e),d={class:"chart-container"},u={class:"chart-title"},h={key:0,class:"chart-subtitle"},v={class:"controls-wrap"},g={class:"chart-controls"},p={class:"time-legend-row"},y=c((()=>(0,r.Lk)("label",{class:"year-label"},"滑动时间",-1))),b={class:"chart-card"};function C(e,t,a,l,o,s){const i=(0,r.g2)("el-slider"),c=(0,r.g2)("ChartView");return(0,r.uX)(),(0,r.CE)("div",d,[(0,r.Lk)("h3",u,(0,n.v_)(a.chart.title),1),a.chart.subtitle?((0,r.uX)(),(0,r.CE)("h4",h,(0,n.v_)(a.chart.subtitle),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",v,[(0,r.Lk)("div",g,[(0,r.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===l.chartType&&!l.isHorizontal}]),onClick:t[0]||(t[0]=e=>l.setChartType("bar",!1))}," 柱状图 ",2),(0,r.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===l.chartType&&l.isHorizontal}]),onClick:t[1]||(t[1]=e=>l.setChartType("bar",!0))}," 条形图 ",2),(0,r.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"line"===l.chartType&&!l.isHorizontal}]),onClick:t[2]||(t[2]=e=>l.setChartType("line",!1))}," 折线图 ",2)]),(0,r.Lk)("div",p,[y,(0,r.bF)(i,{modelValue:l.yearLimit,"onUpdate:modelValue":t[3]||(t[3]=e=>l.yearLimit=e),min:1,max:20,step:1,"show-tooltip":"","format-tooltip":l.formatTooltip,class:"year-slider"},null,8,["modelValue","format-tooltip"]),(0,r.Lk)("button",{class:"toggle-legend-btn",style:(0,n.Tr)({backgroundColor:l.legendAllSelected?"#0bc2d6":"#ccc"}),onClick:t[4]||(t[4]=(...e)=>l.toggleAllLegends&&l.toggleAllLegends(...e))},(0,n.v_)(l.legendAllSelected?"一键未选":"一键全选"),5)])]),(0,r.Lk)("div",b,[(0,r.bF)(c,{ref:"chartViewRef",option:l.chartOption,debug:a.debug,class:"chart-wrapper",onLegendselectchanged:l.handleLegendSelect},null,8,["option","debug","onLegendselectchanged"])])])}var f=a(144),w=a(6301);const m={ref:"chartContainer",class:"chart-view"};function L(e,t,a,n,l,o){return(0,r.uX)(),(0,r.CE)("div",m,null,512)}var k=a(1557),A=a(373),M={name:"ChartView",props:{option:{type:Object,required:!0},debug:{type:Boolean,default:!1}},emits:["legendselectchanged"],setup(e,{emit:t}){const a=(0,f.KR)(null),n=(0,f.KR)(null),l=()=>({animation:!0,tooltip:{trigger:"axis"},legend:{selectedMode:"multiple",selector:!1,left:"center",top:"5%"},grid:{containLabel:!0}}),o=e=>{if(e?.selected){const a=n.value.getOption(),r={};a.series.forEach((e=>{r[e.name]=e.originalName}));const l={};Object.entries(e.selected).forEach((([e,t])=>{r[e]&&(l[r[e]]=t)})),t("legendselectchanged",{selected:l})}},s=e=>{if(n.value)try{const t=JSON.parse(JSON.stringify(e));t.series=Array.isArray(t.series)?t.series.filter((e=>e&&e.type)):[];const a={...l(),...t,legend:{...t.legend,selectedMode:"multiple",selector:!1,selected:t.legend?.selected||{}}};n.value.setOption(a,{notMerge:!1,lazyUpdate:!0}),n.value.resize()}catch(t){A.v.error("[ChartView] 配置应用失败:",t),i()}},i=()=>{if(n.value)try{n.value.setOption(l(),{notMerge:!0})}catch(e){A.v.error("应急恢复失败:",e)}},c=()=>{if(a.value)try{n.value&&n.value.dispose(),n.value=k.Ts(a.value,null,{renderer:"canvas",useDirtyRect:!0}),n.value.on("legendselectchanged",o),n.value.on("error",(e=>{A.v.error("ECharts 内部错误:",e)})),s(e.option)}catch(t){A.v.error("[ChartView] 初始化失败:",t)}else A.v.error("[ChartView] 容器元素未找到")},d=()=>{n.value?.resize()},u=(0,w.A)(d,300);(0,r.wB)((()=>e.option),(e=>{e&&s(e)}),{deep:!0}),(0,r.sV)((()=>{c(),window.addEventListener("resize",u)})),(0,r.xo)((()=>{window.removeEventListener("resize",u),u.cancel(),n.value?.dispose()}));const h=()=>n.value;return{chartContainer:a,getChartInstance:h,handleResize:d}}},T=a(1241);const z=(0,T.A)(M,[["render",L],["__scopeId","data-v-5c7d1fd0"]]);var O=z,S=a(5e3),E={name:"ChartContainer",components:{ChartView:O},props:{chart:{type:Object,required:!0,validator:e=>["title","zbcodeArr"].every((t=>t in e))},returnData:{type:Object,required:!0},config:{type:Object,default:()=>({})},viewMode:{type:String,default:"monthly",validator:e=>["monthly","yearly"].includes(e)},debug:{type:Boolean,default:!1}},setup(e,{expose:t}){const a=(0,f.KR)(null),n=(0,f.KR)("bar"),l=(0,f.KR)(!1),o=(0,f.KR)(10),s=(0,f.KR)({}),i=(0,f.KR)(!0),c=(0,f.KR)({}),d=()=>{const e=Object.keys(s.value);i.value=e.length>0&&e.every((e=>s.value[e]))},u=()=>{const t=(0,S.HM)({data:e.returnData,zbcodeArr:e.chart.zbcodeArr,cityCodeArr:e.config?.cityCodeArr||[],isHorizontal:l.value});if(t.legend?.data){const e={};t.series.forEach((t=>{e[t.originalName]=!0})),s.value=e,d()}},h=()=>{const t={data:e.returnData,title:e.chart.title,subtitle:e.chart.subtitle,zbcodeArr:e.chart.zbcodeArr,cityCodeArr:e.config?.cityCodeArr||[],dbCode:e.chart.dbCode||"nd",unit:e.chart.unit||"",exceptName:e.chart.exceptName||"",legendTop:"5%",gridTop:e.chart.gridTop,chartType:n.value,yearLimit:o.value,isHorizontal:l.value,legendAllSelected:i.value,legendStates:{...s.value},forceMultiSelect:!0},a=(0,S.HM)(t);return delete a.title,a},v=()=>{c.value=h(),A.v.debug("更新图表配置")},g=e=>{e?.selected&&(s.value={...e.selected},d(),v())},p=()=>{const e=!i.value;i.value=e;const t={};Object.keys(s.value).forEach((a=>{t[a]=e})),s.value=t,v()},y=(e,t)=>{n.value=e,l.value=t,v()},b=e=>`${e}年`,C=(0,w.A)((()=>{a.value?.getChartInstance()?.resize()}),300);(0,r.sV)((()=>{u(),v(),window.addEventListener("resize",C)})),(0,r.xo)((()=>{window.removeEventListener("resize",C),C.cancel()})),(0,r.wB)(o,v);const m=()=>a.value?.getChartInstance();return t({getChartInstance:m}),{chartViewRef:a,chartType:n,isHorizontal:l,yearLimit:o,legendAllSelected:i,chartOption:c,setChartType:y,handleLegendSelect:g,toggleAllLegends:p,formatTooltip:b}}};const R=(0,T.A)(E,[["render",C],["__scopeId","data-v-5325215c"]]);var V=R,j={components:{ChartContainer:V},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")&&e.has("nd")},defaultViewMode(){const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")?"monthly":e.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((e=>"monthly"===this.viewMode?"yd"===e.dbCode:"nd"===e.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((e=>{const t=this.returnData?.dataList?.sj?.[e.dbCode];return Array.isArray(t)&&t.length>0}))}},created(){this.viewMode=this.defaultViewMode}};const K=(0,T.A)(j,[["render",i],["__scopeId","data-v-ce7a7c4e"]]);var D=K}}]);
//# sourceMappingURL=5150.b768cd55.js.map