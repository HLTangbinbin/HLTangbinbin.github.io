{"version":3,"file":"js/9892.97abf6d7.js","mappings":"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","sources":["webpack://tangdata/./src/components/common/ChartCard.vue","webpack://tangdata/./src/components/common/ChartCard.vue?7a80","webpack://tangdata/./src/components/common/ChartContainer.vue","webpack://tangdata/./src/components/common/ChartContainer.vue?9df1","webpack://tangdata/./src/components/common/ChartPage.vue","webpack://tangdata/./src/components/common/ChartPage.vue?6ceb","webpack://tangdata/./src/components/common/ChartView.vue","webpack://tangdata/./src/components/common/ChartView.vue?7c38"],"sourcesContent":["<template>\n  <div class=\"chart-card\">\n    <ChartView :option=\"chartOption\" class=\"chart-wrapper\" />\n  </div>\n</template>\n\n<script>\nimport ChartView from './ChartView.vue';\nimport { getCommonChartOption } from '@/utils/CommonUtil.js';\n\nexport default {\n  components: { ChartView },\n  props: {\n    chart: Object,\n    returnData: Object,\n    config: Object,\n    chartType: String, // 'bar' 或 'line'\n    yearLimit: {\n      type: Number,\n      default: 10\n    },\n    isHorizontal: Boolean,\n    legendAllSelected: Boolean,\n  },\n  computed: {\n    adjustedLegendTop() {\n      const baseTop = this.chart.legendTop || '15%';\n\n      // 处理字符串百分比\n      if (window.innerWidth <= 768) { // 移动端\n        if (typeof baseTop === 'string' && baseTop.endsWith('%')) {\n          const num = parseFloat(baseTop);\n          return (num / 3) + '%'; // 缩小为原来的三分之一\n        }\n        if (typeof baseTop === 'number') {\n          return baseTop / 3; // 数值缩小\n        }\n        return '5%'; // 默认值\n      }\n      // PC端正常返回\n      return baseTop;\n    },\n\n    chartOption() {\n      const params = {\n        // 只取必要字段，避免污染\n        data: this.returnData,\n        cityCodeArr: this.config?.cityCodeArr || [],\n        // 图表相关\n        title: this.chart.title,\n        subtitle: this.chart.subtitle,\n        dbCode: this.chart.dbCode,\n        zbcodeArr: this.chart.zbcodeArr,\n        unit: this.chart.unit,\n        exceptName: this.chart.exceptName,\n        legendTop: this.adjustedLegendTop,\n        gridTop: this.chart.gridTop,\n        echrtId: this.chart.id,\n        chartType: this.chartType,\n        yearLimit: this.yearLimit,\n        isHorizontal: this.isHorizontal,\n        legendAllSelected: this.legendAllSelected,\n        \n      };\n      const option = getCommonChartOption(params);\n\n      if (option.title) delete option.title; // 防止重复标题显示\n\n      return option;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.chart-card {\n  width: 95%;\n  height: 600px;\n  margin: 0 auto;\n}\n\n.chart-wrapper {\n  width: 100%;\n  height: 100%;\n}\n</style>","import { render } from \"./ChartCard.vue?vue&type=template&id=16ae2ee1&scoped=true\"\nimport script from \"./ChartCard.vue?vue&type=script&lang=js\"\nexport * from \"./ChartCard.vue?vue&type=script&lang=js\"\n\nimport \"./ChartCard.vue?vue&type=style&index=0&id=16ae2ee1&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-16ae2ee1\"]])\n\nexport default __exports__","<template>\n  <div class=\"chart-container\">\n    <h3 class=\"chart-title\">{{ chart.title }}</h3>\n    <h4 v-if=\"chart.subtitle\" class=\"chart-subtitle\">{{ chart.subtitle }}</h4>\n\n    <!-- 父容器：包含第一行按钮和第二行控件 -->\n    <div class=\"controls-wrap\">\n      <!-- 第一行按钮 -->\n      <div class=\"chart-controls\">\n        <button\n          :class=\"['chart-button', { 'is-active': chartType === 'bar' && !isHorizontal }]\"\n          @click=\"chartType='bar'; isHorizontal=false\"\n        >柱状图</button>\n        <button\n          :class=\"['chart-button', { 'is-active': chartType === 'bar' && isHorizontal }]\"\n          @click=\"chartType='bar'; isHorizontal=true\"\n        >条形图</button>\n        <button\n          :class=\"['chart-button', { 'is-active': chartType === 'line' && !isHorizontal }]\"\n          @click=\"chartType='line'; isHorizontal=false\"\n        >折线图</button>\n      </div>\n\n      <!-- 第二行控件 -->\n      <div class=\"time-legend-row\">\n        <div class=\"year-selector\">\n          <label class=\"year-label\">选择时间范围</label>\n          <el-slider\n            v-model=\"yearLimit\"\n            :min=\"1\"\n            :max=\"20\"\n            :step=\"1\"\n            show-tooltip\n            :format-tooltip=\"formatTooltip\"\n            class=\"year-slider\"\n          />\n        </div>\n  <button\n    class=\"toggle-legend-btn\"\n    :style=\"{ backgroundColor: legendAllSelected ? '#0bc2d6' : '#ccc' }\"\n    @click=\"toggleLegend\"\n  >\n    {{ legendAllSelected ? '一键未选' : '一键全选' }}\n  </button>\n      </div>\n    </div>\n\n    <!-- 图表 -->\n    <ChartCard\n      :chart=\"chart\"\n      :chartType=\"chartType\"\n      :returnData=\"returnData\"\n      :config=\"config\"\n      :yearLimit=\"yearLimit\"\n      :isHorizontal=\"isHorizontal\"\n      :legendAllSelected=\"legendAllSelected\"\n    />\n  </div>\n</template>\n\n<script>\nimport { ref } from 'vue';\nimport ChartCard from './ChartCard.vue';\n\nexport default {\n  components: { ChartCard },\n  props: {\n    chart: Object,\n    returnData: Object,\n    config: Object,\n    initialChartType: { type: String, default: 'bar' },\n    viewMode: String,\n  },\n  setup(props) {\n    const chartType = ref(props.initialChartType);\n    const isHorizontal = ref(false);\n    const yearLimit = ref(10);\n    const legendAllSelected = ref(true);\n\n    const toggleLegend = () => {\n      legendAllSelected.value = !legendAllSelected.value;\n    };\n\n    const formatTooltip = (val) => {\n      const unit = props.viewMode === 'monthly' ? '个月' : '年';\n      return `近 ${val} ${unit}`;\n    };\n\n    return { chartType, isHorizontal, yearLimit, legendAllSelected, toggleLegend, formatTooltip };\n  },\n};\n</script>\n\n<style scoped>\n.chart-container {\n  width: 100%;\n  max-width: 1500px;\n  margin: 50px auto 60px;\n  padding: 16px;\n  box-sizing: border-box;\n  background-color: #fff;\n  border-radius: 12px;\n  box-shadow: 0 0 8px rgba(0,0,0,0.06);\n}\n\n.chart-title {\n  text-align: center;\n  font-size: 18px;\n  font-weight: 700;\n  color: #333;\n  margin: 24px 0 6px;\n}\n\n.chart-subtitle {\n  font-size: 13px;\n  font-weight: bold;\n  line-height: 20px;\n  color: #666;\n  text-align: center;\n  white-space: pre-line;\n  overflow-wrap: break-word;\n  margin: 0 auto 12px;\n  max-width: 80vw;\n}\n\n/* 父容器：包含第一行按钮和第二行控件 */\n.controls-wrap {\n  display: flex;\n  flex-direction: column;\n  width: fit-content;  /* 宽度自适应内容，即第一行按钮总宽度 */\n  margin: 0 auto;      /* 整体居中页面 */\n  align-items: stretch; /* 第二行控件撑满父容器 */\n}\n\n/* 第一行按钮 */\n.chart-controls {\n  display: flex;\n  justify-content: center; /* 整体居中 */\n  gap: 12px;\n  margin-top: 16px;        /* 调整与标题间距，原来可能太小 */\n}\n\n/* 第二行控件 */\n.time-legend-row {\n  display: flex;\n  justify-content: space-between; /* 左右对齐 */\n  align-items: flex-start;        /* 顶部对齐 */\n  margin-top: 16px;\n}\n\n/* 左边选择时间 */\n.year-selector {\n  display: flex;\n  flex-direction: column;\n    min-width: 80px;       /* 保证内容不挤 */\n}\n\n.year-label {\n  padding: 6px 8px;\n  font-size: 13px;\n  border-radius: 8px;\n  font-weight: bold;\n  margin-bottom: 8px;\n  color: #fff;\n  background-color: #0bc2d6;\n}\n\n.year-slider {\n  max-width: 200px; /* 可调整或使用 flex-grow 自适应 */\n}\n\n/* element-plus 滑块样式 */\n::v-deep(.year-slider .el-slider__bar) { background-color: #0bc2d6 !important; }\n::v-deep(.year-slider .el-slider__button) { background-color: #0bc2d6 !important; border-color: #0bc2d6 !important; }\n\n.toggle-legend-btn {\n  display: inline-flex;\n  padding: 6px 12px;\n  height: auto;\n  align-items: center;\n  color: #fff;\n  border: none;\n  border-radius: 10px;\n  cursor: pointer;\n  transition: background 0.3s;\n}\n\n/* 按钮样式 */\n.chart-button {\n  padding: 6px 12px;\n  font-size: 13px;\n  border-radius: 10px;\n  background-color: #ccc;\n  color: #fff;\n  border: none;\n  cursor: pointer;\n  transition: background 0.3s;\n}\n.chart-button.is-active { background-color: #0bc2d6; }\n</style>","import { render } from \"./ChartContainer.vue?vue&type=template&id=719eb7c0&scoped=true\"\nimport script from \"./ChartContainer.vue?vue&type=script&lang=js\"\nexport * from \"./ChartContainer.vue?vue&type=script&lang=js\"\n\nimport \"./ChartContainer.vue?vue&type=style&index=0&id=719eb7c0&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-719eb7c0\"]])\n\nexport default __exports__","<template>\n  <div class=\"echart-container\">\n    <div v-if=\"internalShowToggles\" class=\"segment-container\">\n      <div class=\"segment-wrapper\">\n        <div class=\"segment-bg\" :class=\"viewMode\"></div>\n        <button class=\"segment-button\" :class=\"{ active: viewMode === 'monthly' }\"\n          @click=\"viewMode = 'monthly'\">月度</button>\n        <button class=\"segment-button\" :class=\"{ active: viewMode === 'yearly' }\"\n          @click=\"viewMode = 'yearly'\">年度</button>\n      </div>\n    </div>\n\n    <ChartContainer v-for=\"chart in chartsToRender\" :key=\"chart.id\" :chart=\"chart\" :returnData=\"returnData\"\n      :config=\"config\" :viewMode=\"viewMode\" />\n  </div>\n</template>\n\n<script>\nimport ChartContainer from './ChartContainer.vue';\n\nexport default {\n  components: { ChartContainer },\n  props: {\n    chartMetaList: Array,\n    returnData: Object,\n    config: Object,\n    showToggles: { type: Boolean, default: true },\n  },\n  data() {\n    return {\n      viewMode: 'monthly',\n    };\n  },\n  computed: {\n    internalShowToggles() {\n      if (!this.showToggles) return false;\n      const dbCodes = new Set(this.chartMetaList.map((c) => c.dbCode));\n      return dbCodes.has('yd') && dbCodes.has('nd');\n    },\n    defaultViewMode() {\n      const dbCodes = new Set(this.chartMetaList.map((c) => c.dbCode));\n      if (dbCodes.has('yd')) return 'monthly';\n      if (dbCodes.has('nd')) return 'yearly';\n      return 'monthly';\n    },\n    filteredCharts() {\n      if (!this.internalShowToggles) return this.chartMetaList;\n      return this.chartMetaList.filter((c) =>\n        this.viewMode === 'monthly' ? c.dbCode === 'yd' : c.dbCode === 'nd'\n      );\n    },\n    chartsToRender() {\n      return this.filteredCharts.filter((chart) => {\n        const sj = this.returnData?.dataList?.sj?.[chart.dbCode];\n        return Array.isArray(sj) && sj.length > 0;\n      });\n    },\n  },\n  created() {\n    this.viewMode = this.defaultViewMode;\n  },\n};\n</script>\n\n<style scoped>\n.segment-container {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  margin-top: 10px;\n  margin-bottom: 30px;\n}\n\n.segment-wrapper {\n  position: relative;\n  display: flex;\n  width: 200px;\n  height: 45px;\n  background-color: #fff;\n  border-radius: 999px;\n  padding: 2px;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  /* ✅ 外部阴影更明显 */\n}\n\n/* 背景高亮滑块 */\n.segment-bg {\n  position: absolute;\n  top: 2px;\n  bottom: 2px;\n  width: 50%;\n  border-radius: 999px;\n  background-color: #0bc2d6;\n  transition: left 0.25s ease;\n  z-index: 0;\n}\n\n.segment-bg.monthly {\n  left: 2px;\n}\n\n.segment-bg.yearly {\n  left: 50%;\n}\n\n/* 按钮本体 */\n.segment-button {\n  position: relative;\n  flex: 1;\n  z-index: 1;\n  border: none;\n  outline: none;\n  background: transparent;\n  color: #333;\n  font-size: 14px;\n  font-weight: 500;\n  border-radius: 999px;\n  cursor: pointer;\n  transition: color 0.25s ease;\n}\n\n.segment-button.active {\n  color: #fff;\n}\n\n\n</style>","import { render } from \"./ChartPage.vue?vue&type=template&id=ce7a7c4e&scoped=true\"\nimport script from \"./ChartPage.vue?vue&type=script&lang=js\"\nexport * from \"./ChartPage.vue?vue&type=script&lang=js\"\n\nimport \"./ChartPage.vue?vue&type=style&index=0&id=ce7a7c4e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-ce7a7c4e\"]])\n\nexport default __exports__","<template>\n  <div ref=\"chartContainer\" class=\"chart-view\"></div>\n</template>\n\n<script>\nimport { ref, onMounted, onBeforeUnmount, watch, nextTick } from 'vue';\nimport * as echarts from 'echarts';\n\nexport default {\n  name: 'ChartView',\n  props: {\n    option: {\n      type: Object,\n      required: true\n    },\n    debug: { // 可在父组件临时传 debug=true 打开更多日志\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(props) {\n    const chartContainer = ref(null);\n    let chartInstance = null;\n    let resizeObserver = null;\n    let initCount = 0;\n    let disposeCount = 0;\n    let setOptionCount = 0;\n\n    const log = (...args) => {\n      if (props.debug) {\n        console.log('[ChartView]', ...args);\n      }\n    };\n\n    const initChart = () => {\n      if (!chartContainer.value) return;\n\n      if (!chartInstance) {\n        initCount++;\n        console.time(`echarts-init-${initCount}`);\n        chartInstance = echarts.init(chartContainer.value);\n        console.timeEnd(`echarts-init-${initCount}`);\n        log(`init #${initCount} (container):`, chartContainer.value);\n\n        // resize 监听\n        window.addEventListener('resize', resizeChart);\n\n        resizeObserver = new ResizeObserver(() => {\n          if (chartInstance) {\n            chartInstance.resize();\n          }\n        });\n        resizeObserver.observe(chartContainer.value);\n      }\n\n      // 首次初始化后，如果已有 option 立即 setOption 一次\n      if (props.option && Object.keys(props.option).length > 0) {\n        applyOption(props.option);\n      }\n    };\n\n    const applyOption = (opt) => {\n      if (!chartInstance) return;\n      setOptionCount++;\n      const label = `echarts-setOption-${setOptionCount}`;\n      console.time(label);\n      // 第2个参数 notMerge = false 保留合并逻辑（你之前改成 false）\n      // 第3个参数 lazyUpdate = true 尽量降低同步更新开销（可观察效果）\n      try {\n        chartInstance.setOption(opt, false, true);\n      } catch (e) {\n        console.error('[ChartView] setOption error', e);\n      }\n      console.timeEnd(label);\n      log(`setOption count=${setOptionCount}`);\n    };\n\n    const resizeChart = () => {\n      if (chartInstance) {\n        chartInstance.resize();\n      }\n    };\n\n    onMounted(async () => {\n      await nextTick();\n      log('onMounted');\n      initChart();\n    });\n\n    watch(\n      () => props.option,\n      (newOption) => {\n        if (newOption && Object.keys(newOption).length > 0) {\n          // 给出更多日志：测量从 watch 到 setOption 的时间\n          const t0 = performance.now();\n          applyOption(newOption);\n          const t1 = performance.now();\n          log(`watch->applyOption elapsed ${(t1 - t0).toFixed(1)} ms`);\n        }\n      },\n      { deep: true }\n    );\n\n    onBeforeUnmount(() => {\n      disposeCount++;\n      console.time(`echarts-dispose-${disposeCount}`);\n      window.removeEventListener('resize', resizeChart);\n\n      if (resizeObserver && chartContainer.value) {\n        try {\n          resizeObserver.unobserve(chartContainer.value);\n          resizeObserver.disconnect();\n        } catch (e) { /* ignore */ }\n        resizeObserver = null;\n      }\n\n      if (chartInstance) {\n        try {\n          chartInstance.dispose();\n        } catch (e) { /* ignore */ }\n        chartInstance = null;\n      }\n      console.timeEnd(`echarts-dispose-${disposeCount}`);\n      log('onBeforeUnmount, disposeCount=', disposeCount);\n    });\n\n    return {\n      chartContainer\n    };\n  }\n};\n</script>\n\n<style scoped>\n.chart-view {\n  width: 100%;\n  height: 100%;\n}\n</style>","import { render } from \"./ChartView.vue?vue&type=template&id=4a7cde61&scoped=true\"\nimport script from \"./ChartView.vue?vue&type=script&lang=js\"\nexport * from \"./ChartView.vue?vue&type=script&lang=js\"\n\nimport \"./ChartView.vue?vue&type=style&index=0&id=4a7cde61&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-4a7cde61\"]])\n\nexport default __exports__"],"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_ChartView","option","$options","chartOption","components","ChartView","props","chart","Object","returnData","config","chartType","String","yearLimit","type","Number","default","isHorizontal","Boolean","legendAllSelected","computed","adjustedLegendTop","baseTop","this","legendTop","window","innerWidth","endsWith","num","parseFloat","params","data","cityCodeArr","title","subtitle","dbCode","zbcodeArr","unit","exceptName","gridTop","echrtId","id","getCommonChartOption","__exports__","render","key","_createElementVNode","_hoisted_2","_toDisplayString","$props","_hoisted_3","_createCommentVNode","_hoisted_4","_hoisted_5","_normalizeClass","$setup","onClick","_cache","$event","_hoisted_6","_hoisted_7","_hoisted_8","_component_el_slider","modelValue","min","max","step","formatTooltip","style","_normalizeStyle","backgroundColor","args","toggleLegend","_component_ChartCard","ChartCard","initialChartType","viewMode","setup","ref","value","val","internalShowToggles","$data","active","_Fragment","_renderList","chartsToRender","_createBlock","_component_ChartContainer","ChartContainer","chartMetaList","Array","showToggles","dbCodes","Set","map","c","has","defaultViewMode","filteredCharts","filter","sj","dataList","isArray","length","created","name","required","debug","chartContainer","chartInstance","resizeObserver","initCount","disposeCount","setOptionCount","log","console","initChart","time","echarts","timeEnd","addEventListener","resizeChart","ResizeObserver","resize","observe","keys","applyOption","opt","label","setOption","e","error","onMounted","async","nextTick","watch","newOption","t0","performance","now","t1","toFixed","deep","onBeforeUnmount","removeEventListener","unobserve","disconnect","dispose"],"sourceRoot":""}