"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[5577],{5577:function(e,t,r){r.d(t,{A:function(){return I}});var n=r(6768),a=r(4232);const i={class:"echart-container"},o={key:0,class:"segment-container"},s={class:"segment-wrapper"};function l(e,t,r,l,c,d){const h=(0,n.g2)("ChartContainer");return(0,n.uX)(),(0,n.CE)("div",i,[d.internalShowToggles?((0,n.uX)(),(0,n.CE)("div",o,[(0,n.Lk)("div",s,[(0,n.Lk)("div",{class:(0,a.C4)(["segment-bg",c.viewMode])},null,2),(0,n.Lk)("button",{class:(0,a.C4)(["segment-button",{active:"monthly"===c.viewMode}]),onClick:t[0]||(t[0]=e=>c.viewMode="monthly")},"月度",2),(0,n.Lk)("button",{class:(0,a.C4)(["segment-button",{active:"yearly"===c.viewMode}]),onClick:t[1]||(t[1]=e=>c.viewMode="yearly")},"年度",2)])])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(d.chartsToRender,(e=>((0,n.uX)(),(0,n.Wv)(h,{key:e.id,chart:e,returnData:r.returnData,config:r.config,viewMode:c.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}const c=e=>((0,n.Qi)("data-v-5283f56c"),e=e(),(0,n.jt)(),e),d={class:"chart-container"},h={class:"chart-title"},u={key:0,class:"chart-subtitle"},p={class:"controls-wrap"},g={class:"chart-controls"},v={class:"time-legend-row"},y=c((()=>(0,n.Lk)("label",{class:"year-label"},"滑动时间",-1)));function b(e,t,r,i,o,s){const l=(0,n.g2)("el-slider"),c=(0,n.g2)("ChartCard");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("h3",h,(0,a.v_)(r.chart.title),1),r.chart.subtitle?((0,n.uX)(),(0,n.CE)("h4",u,(0,a.v_)(r.chart.subtitle),1)):(0,n.Q3)("",!0),(0,n.Lk)("div",p,[(0,n.Lk)("div",g,[(0,n.Lk)("button",{class:(0,a.C4)(["chart-button",{"is-active":"bar"===i.chartType&&!i.isHorizontal}]),onClick:t[0]||(t[0]=e=>{i.chartType="bar",i.isHorizontal=!1})},"柱状图",2),(0,n.Lk)("button",{class:(0,a.C4)(["chart-button",{"is-active":"bar"===i.chartType&&i.isHorizontal}]),onClick:t[1]||(t[1]=e=>{i.chartType="bar",i.isHorizontal=!0})},"条形图",2),(0,n.Lk)("button",{class:(0,a.C4)(["chart-button",{"is-active":"line"===i.chartType&&!i.isHorizontal}]),onClick:t[2]||(t[2]=e=>{i.chartType="line",i.isHorizontal=!1})},"折线图",2)]),(0,n.Lk)("div",v,[y,(0,n.bF)(l,{modelValue:i.yearLimit,"onUpdate:modelValue":t[3]||(t[3]=e=>i.yearLimit=e),min:1,max:20,step:1,"show-tooltip":"","format-tooltip":i.formatTooltip,class:"year-slider"},null,8,["modelValue","format-tooltip"]),(0,n.Lk)("button",{class:"toggle-legend-btn",style:(0,a.Tr)({backgroundColor:i.legendAllSelected?"#0bc2d6":"#ccc"}),onClick:t[4]||(t[4]=(...e)=>i.toggleLegend&&i.toggleLegend(...e))},(0,a.v_)(i.legendAllSelected?"一键未选":"一键全选"),5)])]),(0,n.bF)(c,{chart:r.chart,chartType:i.chartType,returnData:r.returnData,config:r.config,yearLimit:i.yearLimit,isHorizontal:i.isHorizontal,legendAllSelected:i.legendAllSelected},null,8,["chart","chartType","returnData","config","yearLimit","isHorizontal","legendAllSelected"])])}var m=r(144);const w={class:"chart-card"};function f(e,t,r,a,i,o){const s=(0,n.g2)("ChartView");return(0,n.uX)(),(0,n.CE)("div",w,[(0,n.bF)(s,{option:o.chartOption,class:"chart-wrapper"},null,8,["option"])])}const C={ref:"chartContainer",class:"chart-view"};function L(e,t,r,a,i,o){return(0,n.uX)(),(0,n.CE)("div",C,null,512)}r(4114);var T=r(1557),z=r(373);const k=new Map,M=20;var O={name:"ChartView",props:{option:{type:Object,required:!0},debug:{type:Boolean,default:!1},performance:{type:Object,default:()=>({enableVirtualization:!0,enableThrottle:!0,throttleDelay:16,enableLazyUpdate:!0,enableResizeOptimization:!0})}},setup(e){const t=(0,m.KR)(null);let r=null,a=null,i=0,o=0,s=0,l=null,c=0;const d=(...t)=>{e.debug&&z.v.debug("[ChartView]",...t)},h=()=>{for(const[e,r]of k.entries())if(!r.inUse){r.inUse=!0,k.delete(e);const n=t.value;r.dispose();const a=T.Ts(n,null,{renderer:"canvas",useDirtyRect:!0,useCoarsePointer:!0});return a}return null},u=e=>{if(!e||k.size>=M)return void(e&&e.dispose());e.clear(),e.inUse=!1,e.container=null;const t=`chart_${Date.now()}_${Math.random()}`;k.set(t,e)},p=()=>{t.value&&(r=h(),r||(i++,z.v.time(`echarts-init-${i}`),r=T.Ts(t.value,null,{renderer:"canvas",useDirtyRect:!0,useCoarsePointer:!0}),z.v.timeEnd(`echarts-init-${i}`),d(`init #${i} (container):`,t.value),e.performance.enableResizeOptimization?window.addEventListener("resize",g):window.addEventListener("resize",y),window.ResizeObserver&&(a=new ResizeObserver((()=>{r&&e.performance.enableThrottle?g():r&&r.resize()})),a.observe(t.value))),e.option&&Object.keys(e.option).length>0&&v(e.option))},g=()=>{const t=Date.now();t-c<e.performance.throttleDelay?(l&&clearTimeout(l),l=setTimeout((()=>{r&&(r.resize(),c=Date.now())}),e.performance.throttleDelay)):r&&(r.resize(),c=t)},v=t=>{if(!r)return;s++;const a=`echarts-setOption-${s}`;z.v.time(a);try{const a=[t,!1];e.performance.enableLazyUpdate&&a.push(!0),r.setOption(...a),e.performance.enableVirtualization&&t.series&&(0,n.dY)((()=>{r&&r.resize()}))}catch(i){z.v.error("[ChartView] setOption error",i)}z.v.timeEnd(a),d(`setOption count=${s}`)},y=()=>{r&&r.resize()};return(0,n.sV)((async()=>{await(0,n.dY)(),d("onMounted"),p()})),(0,n.wB)((()=>e.option),(e=>{if(e&&Object.keys(e).length>0){const t=performance.now();v(e);const r=performance.now();d(`watch->applyOption elapsed ${(r-t).toFixed(1)} ms`)}}),{deep:!0}),(0,n.xo)((()=>{l&&clearTimeout(l),a&&a.disconnect(),r&&(o++,d(`dispose #${o}`),u(r),r=null),window.removeEventListener("resize",g),window.removeEventListener("resize",y)})),{chartContainer:t}}},A=r(1241);const D=(0,A.A)(O,[["render",L],["__scopeId","data-v-3ca93d92"]]);var S=D,j=r(5e3),H={components:{ChartView:S},props:{chart:Object,returnData:Object,config:Object,chartType:String,yearLimit:{type:Number,default:10},isHorizontal:Boolean,legendAllSelected:Boolean},computed:{adjustedLegendTop(){const e=this.chart.legendTop||"15%";if(window.innerWidth<=768){if("string"===typeof e&&e.endsWith("%")){const t=parseFloat(e);return t/3+"%"}return"number"===typeof e?e/3:"5%"}return e},chartOption(){const e={data:this.returnData,cityCodeArr:this.config?.cityCodeArr||[],title:this.chart.title,subtitle:this.chart.subtitle,dbCode:this.chart.dbCode,zbcodeArr:this.chart.zbcodeArr,unit:this.chart.unit,exceptName:this.chart.exceptName,legendTop:this.adjustedLegendTop,gridTop:this.chart.gridTop,echrtId:this.chart.id,chartType:this.chartType,yearLimit:this.yearLimit,isHorizontal:this.isHorizontal,legendAllSelected:this.legendAllSelected},t=(0,j.HM)(e);return t.title&&delete t.title,t}}};const E=(0,A.A)(H,[["render",f],["__scopeId","data-v-16ae2ee1"]]);var R=E,V={components:{ChartCard:R},props:{chart:Object,returnData:Object,config:Object,initialChartType:{type:String,default:"bar"},viewMode:String},setup(e){const t=(0,m.KR)(e.initialChartType),r=(0,m.KR)(!1),n=(0,m.KR)(10),a=(0,m.KR)(!0),i=()=>{a.value=!a.value},o=t=>{const r="monthly"===e.viewMode?"个月":"年";return`近 ${t} ${r}`};return{chartType:t,isHorizontal:r,yearLimit:n,legendAllSelected:a,toggleLegend:i,formatTooltip:o}}};const _=(0,A.A)(V,[["render",b],["__scopeId","data-v-5283f56c"]]);var $=_,X={components:{ChartContainer:$},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")&&e.has("nd")},defaultViewMode(){const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")?"monthly":e.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((e=>"monthly"===this.viewMode?"yd"===e.dbCode:"nd"===e.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((e=>{const t=this.returnData?.dataList?.sj?.[e.dbCode];return Array.isArray(t)&&t.length>0}))}},created(){this.viewMode=this.defaultViewMode}};const F=(0,A.A)(X,[["render",l],["__scopeId","data-v-ce7a7c4e"]]);var I=F}}]);
//# sourceMappingURL=5577.4691ed03.js.map