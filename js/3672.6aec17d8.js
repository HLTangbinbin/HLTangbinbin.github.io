"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[3672],{3672:function(e,t,a){a.d(t,{A:function(){return P}});var l=a(6768),n=a(4232);const r={class:"echart-container"},o={key:0,class:"segment-container"},s={class:"segment-wrapper"};function i(e,t,a,i,c,d){const u=(0,l.g2)("ChartContainer");return(0,l.uX)(),(0,l.CE)("div",r,[d.internalShowToggles?((0,l.uX)(),(0,l.CE)("div",o,[(0,l.Lk)("div",s,[(0,l.Lk)("div",{class:(0,n.C4)(["segment-bg",c.viewMode])},null,2),(0,l.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"monthly"===c.viewMode}]),onClick:t[0]||(t[0]=e=>c.viewMode="monthly")},"月度",2),(0,l.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"yearly"===c.viewMode}]),onClick:t[1]||(t[1]=e=>c.viewMode="yearly")},"年度",2)])])):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(d.chartsToRender,(e=>((0,l.uX)(),(0,l.Wv)(u,{key:e.id,chart:e,returnData:a.returnData,config:a.config,viewMode:c.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}const c=e=>((0,l.Qi)("data-v-70356cc4"),e=e(),(0,l.jt)(),e),d={class:"chart-container"},u={class:"controls-wrap"},h={class:"controls-row"},g={class:"chart-controls"},v={class:"time-control"},p=c((()=>(0,l.Lk)("label",{class:"year-label"},"选择时间:",-1))),b={class:"offset-value"},f={key:0,class:"line-mode-controls"},C={class:"legend-control"},y={class:"offset-controls"},m=c((()=>(0,l.Lk)("label",{class:"year-label"},"折线偏移:",-1))),L={class:"offset-slider-container"},w={class:"offset-value"},k={class:"chart-card"};function A(e,t,a,r,o,s){const i=(0,l.g2)("el-slider"),c=(0,l.g2)("el-option"),A=(0,l.g2)("el-select"),S=(0,l.g2)("ChartView");return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",u,[(0,l.Lk)("div",h,[(0,l.Lk)("div",g,[(0,l.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===r.currentChartType&&!r.isHorizontal}]),onClick:t[0]||(t[0]=e=>r.setChartType("bar",!1))}," 柱状图 ",2),(0,l.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===r.currentChartType&&r.isHorizontal}]),onClick:t[1]||(t[1]=e=>r.setChartType("bar",!0))}," 条形图 ",2),(0,l.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"line"===r.currentChartType&&!r.isHorizontal}]),onClick:t[2]||(t[2]=e=>r.setChartType("line",!1))}," 折线图 ",2)]),(0,l.Lk)("button",{class:"toggle-legend-btn",style:(0,n.Tr)({backgroundColor:r.legendAllSelected?"#0bc2d6":"#ccc"}),onClick:t[3]||(t[3]=(...e)=>r.toggleAllLegends&&r.toggleAllLegends(...e))},(0,n.v_)(r.legendAllSelected?"一键未选":"一键全选"),5),(0,l.Lk)("div",v,[p,(0,l.bF)(i,{modelValue:r.yearLimit,"onUpdate:modelValue":t[4]||(t[4]=e=>r.yearLimit=e),min:1,max:20,step:1,class:"year-slider"},null,8,["modelValue"]),(0,l.Lk)("span",b,(0,n.v_)(r.yearLimit),1)])]),"line"!==r.currentChartType||r.isHorizontal?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",f,[(0,l.Lk)("div",C,[(0,l.bF)(A,{modelValue:r.selectedLegend,"onUpdate:modelValue":t[5]||(t[5]=e=>r.selectedLegend=e),placeholder:"选择图例",class:"legend-selector"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.legendList,(e=>((0,l.uX)(),(0,l.Wv)(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,l.Lk)("div",y,[m,(0,l.Lk)("div",L,[(0,l.bF)(i,{modelValue:r.offsetValue,"onUpdate:modelValue":t[6]||(t[6]=e=>r.offsetValue=e),min:-20,max:20,step:1,class:"year-slider"},null,8,["modelValue"]),(0,l.Lk)("span",w,(0,n.v_)(r.offsetValue),1)])])]))]),(0,l.Lk)("div",k,[(0,l.bF)(S,{ref:"chartRef",option:r.chartOption,chartId:a.chart.id,initSelectAll:r.legendAllSelected,onLegendStateChange:t[7]||(t[7]=e=>r.legendAllSelected=e)},null,8,["option","chartId","initSelectAll"])])])}var S=a(144);const T={ref:"chartContainer",class:"chart-view"};function M(e,t,a,n,r,o){return(0,l.uX)(),(0,l.CE)("div",T,null,512)}var V=a(2212),O=a(2563),E=a(3757),R=a(9922),z=a(623),K=a(8885),j=a(9536),D=a(4016),I=a(1493),_=a(373),X=a(6301);V.Y([z.a,K.a,j.a,D.a,E.a,R.a,I.a]);var B={name:"ChartView",props:{option:{type:Object,required:!0},chartId:{type:String,required:!0},initSelectAll:{type:Boolean,default:!0}},emits:["legendStateChange"],setup(e,{expose:t,emit:a}){const n=(0,S.KR)(null);let r=null,o=null;const s=()=>{if(!n.value||!e.option?.series?.length)return;const t=performance.now();if(r&&!r.isDisposed())return void i(e.option);r=O.Ts(n.value),r.setOption(e.option,!0);const l=r.getOption().legend?.[0]?.data||[];l.length>0&&l.forEach((t=>{r.dispatchAction({type:e.initSelectAll?"legendSelect":"legendUnSelect",name:t})})),r.on("legendselectchanged",(e=>{const t=Object.values(e.selected).every((e=>!0===e)),l=Object.values(e.selected).every((e=>!1===e));t?a("legendStateChange",!0):l&&a("legendStateChange",!1)})),o||(o=(0,X.A)((()=>{r&&!r.isDisposed()&&r.resize()}),200),window.addEventListener("resize",o));const s=performance.now();_.v.debug(`[Chart ${e.chartId}] 图表初始化耗时: ${Math.round(s-t)}ms`)},i=e=>{r&&!r.isDisposed()?e?.series?.length&&(_.v.debug("updateChart方法调用"),r.setOption(e,!1,!0)):s()},c=t=>{if(!r)return;const a=r.getOption().legend?.[0]?.data||[],l=performance.now();a.forEach((e=>{r.dispatchAction({type:t?"legendSelect":"legendUnSelect",name:e})}));const n=performance.now();_.v.debug(`[Chart ${e.chartId}] toggleAllLegends耗时: ${Math.round(n-l)}ms`)};return(0,l.sV)((()=>{(0,l.dY)((()=>s()))})),(0,l.wB)((()=>e.option),i,{deep:!1}),(0,l.xo)((()=>{o&&(window.removeEventListener("resize",o),o.cancel()),r?.dispose(),r=null})),t({toggleAllLegends:c}),{chartContainer:n}}},H=a(1241);const x=(0,H.A)(B,[["render",M],["__scopeId","data-v-6bfb044d"]]);var F=x,U=a(5e3),q={name:"ChartContainer",components:{ChartView:F},props:{chart:{type:Object,required:!0},returnData:{type:Object,required:!0,default:()=>({})},config:{type:Object,default:()=>({})},viewMode:{type:String,default:"monthly"}},setup(e){const t=(0,S.KR)("bar"),a=(0,S.KR)(!1),n=(0,S.KR)(10),r=(0,S.KR)(!0),o=(0,S.KR)(null),s=(0,S.KR)(null),i=(0,S.KR)(0),c=(0,S.KR)([]),d=(0,l.EW)((()=>c.value)),u=(0,l.EW)((()=>{const l={data:e.returnData,title:e.chart.title||"默认标题",subtitle:e.chart.subtitle||"",zbcodeArr:e.chart.zbcodeArr||[],cityCodeArr:e.config.cityCodeArr||[],dbCode:e.chart.dbCode||"nd",unit:e.chart.unit||"",exceptName:e.chart.exceptName||"",legendTop:e.chart.legendTop,gridTop:e.chart.gridTop,chartType:t.value,yearLimit:n.value,isHorizontal:a.value,enableBirthOffset:e.chart.enableBirthOffset||!1,enableBirthPrediction:e.chart.enableBirthPrediction||!1,selectedLegend:s.value,offsetValue:i.value},r=(0,U.HM)(l);return r}));(0,l.wB)(u,(async e=>{c.value=e?.legend?.data||[],!s.value&&c.value.length>0&&(s.value=c.value[0])}),{immediate:!0});const h=(e,l)=>{t.value=e,a.value=l},g=()=>{_.v.debug("一键全选:",r.value),r.value=!r.value,o.value&&o.value.toggleAllLegends(r.value)};return{currentChartType:t,isHorizontal:a,yearLimit:n,legendAllSelected:r,chartOption:u,setChartType:h,toggleAllLegends:g,chartRef:o,selectedLegend:s,offsetValue:i,legendList:d}}};const W=(0,H.A)(q,[["render",A],["__scopeId","data-v-70356cc4"]]);var $=W,Q={components:{ChartContainer:$},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")&&e.has("nd")},defaultViewMode(){const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")?"monthly":e.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((e=>"monthly"===this.viewMode?"yd"===e.dbCode:"nd"===e.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((e=>{const t=this.returnData?.dataList?.sj?.[e.dbCode];return Array.isArray(t)&&t.length>0}))}},created(){this.viewMode=this.defaultViewMode}};const N=(0,H.A)(Q,[["render",i],["__scopeId","data-v-2eabc8a4"]]);var P=N}}]);
//# sourceMappingURL=3672.6aec17d8.js.map