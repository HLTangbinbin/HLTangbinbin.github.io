"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[9892],{5631:function(t,e,r){r.r(e),r.d(e,{default:function(){return h}});var a=r(6768);const n={class:"chart-card"};function o(t,e,r,o,i,s){const c=(0,a.g2)("ChartView");return(0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(c,{option:s.chartOption,class:"chart-wrapper"},null,8,["option"])])}var i=r(88),s=r(5e3),c={components:{ChartView:i["default"]},props:{chart:Object,returnData:Object,config:Object,chartType:String,yearLimit:{type:Number,default:10},isHorizontal:Boolean},computed:{adjustedLegendTop(){const t=this.chart.legendTop||"15%";if(window.innerWidth<=768){if("string"===typeof t&&t.endsWith("%")){const e=parseFloat(t);return e/3+"%"}return"number"===typeof t?t/3:"5%"}return t},chartOption(){const t={data:this.returnData,cityCodeArr:this.config?.cityCodeArr||[],title:this.chart.title,subtitle:this.chart.subtitle,dbCode:this.chart.dbCode,zbcodeArr:this.chart.zbcodeArr,unit:this.chart.unit,exceptName:this.chart.exceptName,legendTop:this.adjustedLegendTop,gridTop:this.chart.gridTop,echrtId:this.chart.id,chartType:this.chartType,yearLimit:this.yearLimit,isHorizontal:this.isHorizontal},e=(0,s.HM)(t);return e.title&&delete e.title,e}}},l=r(1241);const d=(0,l.A)(c,[["render",o],["__scopeId","data-v-634bd65e"]]);var h=d},8264:function(t,e,r){r.r(e),r.d(e,{default:function(){return v}});var a=r(6768),n=r(4232);const o=t=>((0,a.Qi)("data-v-10d8bf4a"),t=t(),(0,a.jt)(),t),i={class:"chart-container"},s={class:"chart-title"},c={key:0,class:"chart-subtitle"},l={class:"chart-controls"},d={class:"year-selector"},h=o((()=>(0,a.Lk)("label",{class:"year-label"},"选择时间范围",-1)));function u(t,e,r,o,u,p){const y=(0,a.g2)("el-slider"),b=(0,a.g2)("ChartCard");return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("h3",s,(0,n.v_)(r.chart.title),1),r.chart.subtitle?((0,a.uX)(),(0,a.CE)("h4",c,(0,n.v_)(r.chart.subtitle),1)):(0,a.Q3)("",!0),(0,a.Lk)("div",l,[(0,a.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===u.chartType&&!1===u.isHorizontal}]),onClick:e[0]||(e[0]=t=>{u.chartType="bar",u.isHorizontal=!1}),type:"button"}," 柱状图 ",2),(0,a.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===u.chartType&&!0===u.isHorizontal}]),onClick:e[1]||(e[1]=t=>{u.chartType="bar",u.isHorizontal=!0}),type:"button"}," 条形图 ",2),(0,a.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"line"===u.chartType&&!1===u.isHorizontal}]),onClick:e[2]||(e[2]=t=>{u.chartType="line",u.isHorizontal=!1}),type:"button"}," 折线图 ",2)]),(0,a.Lk)("div",d,[h,(0,a.bF)(y,{modelValue:u.yearLimit,"onUpdate:modelValue":e[3]||(e[3]=t=>u.yearLimit=t),min:1,max:20,step:1,"show-tooltip":"","format-tooltip":p.formatTooltip,class:"year-slider"},null,8,["modelValue","format-tooltip"])]),(0,a.bF)(b,{chart:r.chart,chartType:u.chartType,returnData:r.returnData,config:r.config,yearLimit:u.yearLimit,isHorizontal:u.isHorizontal},null,8,["chart","chartType","returnData","config","yearLimit","isHorizontal"])])}var p=r(5631),y={components:{ChartCard:p["default"]},props:{chart:Object,returnData:Object,config:Object,initialChartType:{type:String,default:"bar"},viewMode:String},data(){return{chartType:this.initialChartType,yearLimit:10,isHorizontal:!1}},computed:{formatTooltip(){return t=>{const e="monthly"===this.viewMode?"个月":"年";return`近 ${t} ${e}`}}}},b=r(1241);const f=(0,b.A)(y,[["render",u],["__scopeId","data-v-10d8bf4a"]]);var v=f},9892:function(t,e,r){r.r(e),r.d(e,{default:function(){return p}});var a=r(6768),n=r(4232);const o={class:"echart-container"},i={key:0,class:"segment-container"},s={class:"segment-wrapper"};function c(t,e,r,c,l,d){const h=(0,a.g2)("ChartContainer");return(0,a.uX)(),(0,a.CE)("div",o,[d.internalShowToggles?((0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("div",s,[(0,a.Lk)("div",{class:(0,n.C4)(["segment-bg",l.viewMode])},null,2),(0,a.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"monthly"===l.viewMode}]),onClick:e[0]||(e[0]=t=>l.viewMode="monthly")},"月度",2),(0,a.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"yearly"===l.viewMode}]),onClick:e[1]||(e[1]=t=>l.viewMode="yearly")},"年度",2)])])):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(d.chartsToRender,(t=>((0,a.uX)(),(0,a.Wv)(h,{key:t.id,chart:t,returnData:r.returnData,config:r.config,viewMode:l.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}var l=r(8264),d={components:{ChartContainer:l["default"]},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const t=new Set(this.chartMetaList.map((t=>t.dbCode)));return t.has("yd")&&t.has("nd")},defaultViewMode(){const t=new Set(this.chartMetaList.map((t=>t.dbCode)));return t.has("yd")?"monthly":t.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((t=>"monthly"===this.viewMode?"yd"===t.dbCode:"nd"===t.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((t=>{const e=this.returnData?.dataList?.sj?.[t.dbCode];return Array.isArray(e)&&e.length>0}))}},created(){this.viewMode=this.defaultViewMode}},h=r(1241);const u=(0,h.A)(d,[["render",c],["__scopeId","data-v-ce7a7c4e"]]);var p=u},88:function(t,e,r){r.r(e),r.d(e,{default:function(){return h}});var a=r(6768);const n={ref:"chartContainer",class:"chart-view"};function o(t,e,r,o,i,s){return(0,a.uX)(),(0,a.CE)("div",n,null,512)}var i=r(144),s=r(9671),c={name:"ChartView",props:{option:{type:Object,required:!0},debug:{type:Boolean,default:!1}},setup(t){const e=(0,i.KR)(null);let r=null,n=null,o=0,c=0,l=0;const d=(...e)=>{t.debug&&console.log("[ChartView]",...e)},h=()=>{e.value&&(r||(o++,console.time(`echarts-init-${o}`),r=s.Ts(e.value),console.timeEnd(`echarts-init-${o}`),d(`init #${o} (container):`,e.value),window.addEventListener("resize",p),n=new ResizeObserver((()=>{r&&r.resize()})),n.observe(e.value)),t.option&&Object.keys(t.option).length>0&&u(t.option))},u=t=>{if(!r)return;l++;const e=`echarts-setOption-${l}`;console.time(e);try{r.setOption(t,!1,!0)}catch(a){console.error("[ChartView] setOption error",a)}console.timeEnd(e),d(`setOption count=${l}`)},p=()=>{r&&r.resize()};return(0,a.sV)((async()=>{await(0,a.dY)(),d("onMounted"),h()})),(0,a.wB)((()=>t.option),(t=>{if(t&&Object.keys(t).length>0){const e=performance.now();u(t);const r=performance.now();d(`watch->applyOption elapsed ${(r-e).toFixed(1)} ms`)}}),{deep:!0}),(0,a.xo)((()=>{if(c++,console.time(`echarts-dispose-${c}`),window.removeEventListener("resize",p),n&&e.value){try{n.unobserve(e.value),n.disconnect()}catch(t){}n=null}if(r){try{r.dispose()}catch(t){}r=null}console.timeEnd(`echarts-dispose-${c}`),d("onBeforeUnmount, disposeCount=",c)})),{chartContainer:e}}},l=r(1241);const d=(0,l.A)(c,[["render",o],["__scopeId","data-v-4a7cde61"]]);var h=d}}]);
//# sourceMappingURL=9892.a871679b.js.map