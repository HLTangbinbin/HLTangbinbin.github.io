"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[7833],{7833:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var r=a(6768);function n(e,t,a,n,o,l){const i=(0,r.g2)("ChartPage");return o.returnData?((0,r.uX)(),(0,r.Wv)(i,{key:0,chartMetaList:o.charts,returnData:o.returnData,config:o.config,showToggles:!1},null,8,["chartMetaList","returnData","config"])):(0,r.Q3)("",!0)}var o=a(4660),l=a(5196),i=a(6311),s=a(373),c={name:"CityRealEstateSell",components:{ChartPage:o.A},data(){return{charts:l.bC.charts,returnData:null,config:l.bC.source}},async mounted(){try{this.returnData=await(0,i.hv)(this.config)}catch(e){s.v.error("加载数据失败",e)}}},d=a(1241);const u=(0,d.A)(c,[["render",n]]);var h=u},4660:function(e,t,a){a.d(t,{A:function(){return x}});var r=a(6768),n=a(4232);const o={class:"echart-container"},l={key:0,class:"segment-container"},i={class:"segment-wrapper"};function s(e,t,a,s,c,d){const u=(0,r.g2)("ChartContainer");return(0,r.uX)(),(0,r.CE)("div",o,[d.internalShowToggles?((0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",i,[(0,r.Lk)("div",{class:(0,n.C4)(["segment-bg",c.viewMode])},null,2),(0,r.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"monthly"===c.viewMode}]),onClick:t[0]||(t[0]=e=>c.viewMode="monthly")},"月度",2),(0,r.Lk)("button",{class:(0,n.C4)(["segment-button",{active:"yearly"===c.viewMode}]),onClick:t[1]||(t[1]=e=>c.viewMode="yearly")},"年度",2)])])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.chartsToRender,(e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,chart:e,returnData:a.returnData,config:a.config,viewMode:c.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}const c=e=>((0,r.Qi)("data-v-ce47ef1a"),e=e(),(0,r.jt)(),e),d={class:"chart-container"},u={class:"controls-wrap"},h={class:"chart-controls"},p={class:"time-legend-row"},g=c((()=>(0,r.Lk)("label",{class:"year-label"},"滑动时间",-1))),v={class:"chart-card"};function C(e,t,a,o,l,i){const s=(0,r.g2)("el-slider"),c=(0,r.g2)("ChartView");return(0,r.uX)(),(0,r.CE)("div",d,[(0,r.Lk)("div",u,[(0,r.Lk)("div",h,[(0,r.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===o.currentChartType&&!o.isHorizontal}]),onClick:t[0]||(t[0]=e=>o.setChartType("bar",!1))}," 柱状图 ",2),(0,r.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"bar"===o.currentChartType&&o.isHorizontal}]),onClick:t[1]||(t[1]=e=>o.setChartType("bar",!0))}," 条形图 ",2),(0,r.Lk)("button",{class:(0,n.C4)(["chart-button",{"is-active":"line"===o.currentChartType&&!o.isHorizontal}]),onClick:t[2]||(t[2]=e=>o.setChartType("line",!1))}," 折线图 ",2)]),(0,r.Lk)("div",p,[g,(0,r.bF)(s,{modelValue:o.yearLimit,"onUpdate:modelValue":t[3]||(t[3]=e=>o.yearLimit=e),min:1,max:20,step:1,"show-tooltip":"","format-tooltip":o.formatTooltip,class:"year-slider"},null,8,["modelValue","format-tooltip"]),(0,r.Lk)("button",{class:"toggle-legend-btn",style:(0,n.Tr)({backgroundColor:o.legendAllSelected?"#0bc2d6":"#ccc"}),onClick:t[4]||(t[4]=(...e)=>o.toggleAllLegends&&o.toggleAllLegends(...e))},(0,n.v_)(o.legendAllSelected?"一键未选":"一键全选"),5)])]),(0,r.Lk)("div",v,[(0,r.bF)(c,{option:o.chartOption,class:"chart-wrapper"},null,8,["option"])])])}var y=a(144);const b={ref:"chartContainer",class:"chart-view"};function f(e,t,a,n,o,l){return(0,r.uX)(),(0,r.CE)("div",b,null,512)}var m=a(2212),w=a(2563),L=a(3757),k=a(9922),T=a(8885),A=a(9536),M=a(4016),D=a(1493),O=a(373),S=a(6301);m.Y([T.a,A.a,M.a,L.a,k.a,D.a]);var z={name:"ChartView",props:{option:{type:Object,required:!0,default:()=>({})}},setup(e){const t=(0,y.KR)(null);let a=null,n=null;const o=e=>{a&&e&&e.selected&&Object.values(e.selected).every(Boolean)&&a.dispatchAction({type:"legendInverseSelect"})},l=()=>{t.value&&e.option&&e.option.series&&0!==e.option.series.length&&(a&&(a.dispose(),a=null),a=w.Ts(t.value,null,{renderer:"canvas",width:"auto",height:"auto"}),a.setOption(e.option),a.on("legendselectchanged",o),n=(0,S.A)((()=>{a&&a.resize()}),200),window.addEventListener("resize",n))},i=e=>{a?e&&e.series&&0!==e.series.length&&a.setOption(e,!0):l()};return(0,r.sV)((()=>{l()})),(0,r.wB)((()=>e.option),(e=>{O.v.debug("option 发生变化，更新图表"),i(e)}),{deep:!0}),(0,r.xo)((()=>{O.v.debug("组件即将卸载，清理资源"),n&&(window.removeEventListener("resize",n),n.cancel(),n=null),a&&(a.dispose(),a=null)})),{updateChart:i,chartContainer:t}}},j=a(1241);const E=(0,j.A)(z,[["render",f],["__scopeId","data-v-649f3212"]]);var V=E,R=a(5e3),X={name:"ChartContainer",components:{ChartView:V},props:{chart:{type:Object,required:!0,validator:e=>e.title&&e.zbcodeArr},returnData:{type:Object,required:!0,default:()=>({})},config:{type:Object,default:()=>({})},viewMode:{type:String,default:"monthly",validator:e=>["monthly","yearly"].includes(e)}},setup(e){const t=(0,y.KR)("bar"),a=(0,y.KR)(!1),n=(0,y.KR)(10),o=(0,y.KR)(!0),l=(0,r.EW)((()=>{const r={data:e.returnData,title:e.chart.title||"默认标题",subtitle:e.chart.subtitle||"",zbcodeArr:e.chart.zbcodeArr||[],cityCodeArr:e.config.cityCodeArr||[],dbCode:e.chart.dbCode||"nd",unit:e.chart.unit||"",exceptName:e.chart.exceptName||"",legendTop:e.chart.legendTop,gridTop:e.chart.gridTop,chartType:t.value,yearLimit:n.value,isHorizontal:a.value,legendAllSelected:o.value};return O.v.debug("调用 getCommonChartOption 的参数:",r),(0,R.HM)(r)})),i=(e,r)=>{t.value=e,a.value=r},s=()=>{o.value=!o.value},c=t=>`${e.chart.title} (${t}年)`;return{currentChartType:t,isHorizontal:a,yearLimit:n,legendAllSelected:o,chartOption:l,setChartType:i,toggleAllLegends:s,formatTooltip:c}}};const _=(0,j.A)(X,[["render",C],["__scopeId","data-v-ce47ef1a"]]);var H=_,K={components:{ChartContainer:H},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")&&e.has("nd")},defaultViewMode(){const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")?"monthly":e.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((e=>"monthly"===this.viewMode?"yd"===e.dbCode:"nd"===e.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((e=>{const t=this.returnData?.dataList?.sj?.[e.dbCode];return Array.isArray(t)&&t.length>0}))}},created(){this.viewMode=this.defaultViewMode}};const I=(0,j.A)(K,[["render",s],["__scopeId","data-v-ce7a7c4e"]]);var x=I}}]);
//# sourceMappingURL=7833.86839009.js.map