"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[6472],{6472:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=a(6768);function r(e,t,a,r,o,l){const c=(0,n.g2)("ChartPage");return o.returnData?((0,n.uX)(),(0,n.Wv)(c,{key:0,chartMetaList:o.charts,returnData:o.returnData,config:o.config,showToggles:!1},null,8,["chartMetaList","returnData","config"])):(0,n.Q3)("",!0)}var o=a(6991),l=a(7748),c=a(6311),i=a(373),s={name:"WHPopulation",components:{ChartPage:o.A},data(){return{charts:l.k1.charts,returnData:null,config:l.k1.source}},async mounted(){try{this.returnData=await(0,c.hv)(this.config)}catch(e){i.v.error("加载数据失败",e)}}},d=a(1241);const u=(0,d.A)(s,[["render",r]]);var h=u},6991:function(e,t,a){a.d(t,{A:function(){return x}});var n=a(6768),r=a(4232);const o={class:"echart-container"},l={key:0,class:"segment-container"},c={class:"segment-wrapper"};function i(e,t,a,i,s,d){const u=(0,n.g2)("ChartContainer");return(0,n.uX)(),(0,n.CE)("div",o,[d.internalShowToggles?((0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",c,[(0,n.Lk)("div",{class:(0,r.C4)(["segment-bg",s.viewMode])},null,2),(0,n.Lk)("button",{class:(0,r.C4)(["segment-button",{active:"monthly"===s.viewMode}]),onClick:t[0]||(t[0]=e=>s.viewMode="monthly")},"月度",2),(0,n.Lk)("button",{class:(0,r.C4)(["segment-button",{active:"yearly"===s.viewMode}]),onClick:t[1]||(t[1]=e=>s.viewMode="yearly")},"年度",2)])])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(d.chartsToRender,(e=>((0,n.uX)(),(0,n.Wv)(u,{key:e.id,chart:e,returnData:a.returnData,config:a.config,viewMode:s.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}const s=e=>((0,n.Qi)("data-v-5eb92782"),e=e(),(0,n.jt)(),e),d={class:"chart-container"},u={class:"controls-wrap"},h={class:"chart-controls"},g={class:"time-legend-row"},p=s((()=>(0,n.Lk)("label",{class:"year-label"},"滑动时间",-1))),v={class:"chart-card"};function C(e,t,a,o,l,c){const i=(0,n.g2)("el-slider"),s=(0,n.g2)("ChartView");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",u,[(0,n.Lk)("div",h,[(0,n.Lk)("button",{class:(0,r.C4)(["chart-button",{"is-active":"bar"===o.currentChartType&&!o.isHorizontal}]),onClick:t[0]||(t[0]=e=>o.setChartType("bar",!1))}," 柱状图 ",2),(0,n.Lk)("button",{class:(0,r.C4)(["chart-button",{"is-active":"bar"===o.currentChartType&&o.isHorizontal}]),onClick:t[1]||(t[1]=e=>o.setChartType("bar",!0))}," 条形图 ",2),(0,n.Lk)("button",{class:(0,r.C4)(["chart-button",{"is-active":"line"===o.currentChartType&&!o.isHorizontal}]),onClick:t[2]||(t[2]=e=>o.setChartType("line",!1))}," 折线图 ",2)]),(0,n.Lk)("div",g,[p,(0,n.bF)(i,{modelValue:o.yearLimit,"onUpdate:modelValue":t[3]||(t[3]=e=>o.yearLimit=e),min:1,max:20,step:1,"show-tooltip":"","format-tooltip":o.formatTooltip,class:"year-slider"},null,8,["modelValue","format-tooltip"]),(0,n.Lk)("button",{class:"toggle-legend-btn",style:(0,r.Tr)({backgroundColor:o.legendAllSelected?"#0bc2d6":"#ccc"}),onClick:t[4]||(t[4]=(...e)=>o.toggleAllLegends&&o.toggleAllLegends(...e))},(0,r.v_)(o.legendAllSelected?"一键未选":"一键全选"),5)])]),(0,n.Lk)("div",v,[(0,n.bF)(s,{ref:"chartRef",option:o.chartOption,chartId:a.chart.id,initSelectAll:o.legendAllSelected,onLegendStateChange:t[5]||(t[5]=e=>o.legendAllSelected=e)},null,8,["option","chartId","initSelectAll"])])])}var f=a(144);const y={ref:"chartContainer",class:"chart-view"};function m(e,t,a,r,o,l){return(0,n.uX)(),(0,n.CE)("div",y,null,512)}var b=a(2212),w=a(2563),L=a(3757),A=a(9922),k=a(623),M=a(8885),T=a(9536),S=a(4016),O=a(1493),D=a(373),I=a(6301);b.Y([k.a,M.a,T.a,S.a,L.a,A.a,O.a]);var j={name:"ChartView",props:{option:{type:Object,required:!0},chartId:{type:String,required:!0},initSelectAll:{type:Boolean,default:!0}},emits:["legendStateChange"],setup(e,{expose:t,emit:a}){const r=(0,f.KR)(null);let o=null,l=null;const c=()=>{if(!r.value||!e.option?.series?.length)return;const t=performance.now();o&&(o.dispose(),o=null),o=w.Ts(r.value),o.setOption(e.option,!0);const n=o.getOption().legend?.[0]?.data||[],c=performance.now();n.forEach((t=>{o.dispatchAction({type:e.initSelectAll?"legendSelect":"legendUnSelect",name:t})}));const i=performance.now();D.v.debug(`[Chart ${e.chartId}] dispatchAction循环耗时: ${Math.round(i-c)}ms`),o.on("legendselectchanged",(e=>{const t=Object.values(e.selected).every((e=>!0===e)),n=Object.values(e.selected).every((e=>!1===e));t?a("legendStateChange",!0):n&&a("legendStateChange",!1)})),l=(0,I.A)((()=>o?.resize()),200),window.addEventListener("resize",l);const s=performance.now();D.v.debug(`[Chart ${e.chartId}] 图表初始化耗时: ${Math.round(s-t)}ms`)},i=t=>{if(!o)return void c();if(!t?.series?.length)return;const a=performance.now();o.setOption(t,!1);const n=performance.now();D.v.debug(`[Chart ${e.chartId}] 图表更新耗时: ${Math.round(n-a)}ms`)},s=t=>{if(!o)return;const a=o.getOption().legend?.[0]?.data||[],n=performance.now();a.forEach((e=>{o.dispatchAction({type:t?"legendSelect":"legendUnSelect",name:e})}));const r=performance.now();D.v.debug(`[Chart ${e.chartId}] toggleAllLegends耗时: ${Math.round(r-n)}ms`)};return(0,n.sV)((()=>{(0,n.dY)((()=>c()))})),(0,n.wB)((()=>e.option),i,{deep:!0}),(0,n.xo)((()=>{l&&(window.removeEventListener("resize",l),l.cancel()),o?.dispose(),o=null})),t({toggleAllLegends:s}),{chartContainer:r}}},z=a(1241);const E=(0,z.A)(j,[["render",m],["__scopeId","data-v-70182fa4"]]);var R=E,$=a(5e3),V={name:"ChartContainer",components:{ChartView:R},props:{chart:{type:Object,required:!0},returnData:{type:Object,required:!0,default:()=>({})},config:{type:Object,default:()=>({})},viewMode:{type:String,default:"monthly"}},setup(e){const t=(0,f.KR)("bar"),a=(0,f.KR)(!1),r=(0,f.KR)(10),o=(0,f.KR)(!0),l=(0,f.KR)(null),c=t=>"yearly"===e.viewMode?`近 ${t} 年`:`近 ${t} 月`,i=(0,n.EW)((()=>{const n={data:e.returnData,title:e.chart.title||"默认标题",subtitle:e.chart.subtitle||"",zbcodeArr:e.chart.zbcodeArr||[],cityCodeArr:e.config.cityCodeArr||[],dbCode:e.chart.dbCode||"nd",unit:e.chart.unit||"",exceptName:e.chart.exceptName||"",legendTop:e.chart.legendTop,gridTop:e.chart.gridTop,chartType:t.value,yearLimit:r.value,isHorizontal:a.value};return(0,$.HM)(n)})),s=(e,n)=>{t.value=e,a.value=n},d=()=>{D.v.debug("一键全选:",o.value),o.value=!o.value,l.value&&l.value.toggleAllLegends(o.value)};return{currentChartType:t,isHorizontal:a,yearLimit:r,legendAllSelected:o,chartOption:i,setChartType:s,toggleAllLegends:d,formatTooltip:c,chartRef:l}}};const H=(0,z.A)(V,[["render",C],["__scopeId","data-v-5eb92782"]]);var K=H,X={components:{ChartContainer:K},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")&&e.has("nd")},defaultViewMode(){const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")?"monthly":e.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((e=>"monthly"===this.viewMode?"yd"===e.dbCode:"nd"===e.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((e=>{const t=this.returnData?.dataList?.sj?.[e.dbCode];return Array.isArray(t)&&t.length>0}))}},created(){this.viewMode=this.defaultViewMode}};const _=(0,z.A)(X,[["render",i],["__scopeId","data-v-2eabc8a4"]]);var x=_}}]);
//# sourceMappingURL=6472.4f142882.js.map