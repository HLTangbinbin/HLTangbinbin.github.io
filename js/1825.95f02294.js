"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[1825],{1825:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=a(6768);function r(e,t,a,r,l,o){const i=(0,n.g2)("ChartPage");return l.returnData?((0,n.uX)(),(0,n.Wv)(i,{key:0,chartMetaList:l.charts,returnData:l.returnData,config:l.config,showToggles:!0},null,8,["chartMetaList","returnData","config"])):(0,n.Q3)("",!0)}var l=a(3436),o=a(6280),i=a(6311),c=a(373),s={name:"RealEstateSell",components:{ChartPage:l.A},data(){return{charts:o.VZ.charts,returnData:null,config:o.VZ.source}},async mounted(){try{this.returnData=await(0,i.hv)(this.config)}catch(e){c.v.error("加载数据失败",e)}}},d=a(1241);const u=(0,d.A)(s,[["render",r]]);var h=u},3436:function(e,t,a){a.d(t,{A:function(){return I}});var n=a(6768),r=a(4232);const l={class:"echart-container"},o={key:0,class:"segment-container"},i={class:"segment-wrapper"};function c(e,t,a,c,s,d){const u=(0,n.g2)("ChartContainer");return(0,n.uX)(),(0,n.CE)("div",l,[d.internalShowToggles?((0,n.uX)(),(0,n.CE)("div",o,[(0,n.Lk)("div",i,[(0,n.Lk)("div",{class:(0,r.C4)(["segment-bg",s.viewMode])},null,2),(0,n.Lk)("button",{class:(0,r.C4)(["segment-button",{active:"monthly"===s.viewMode}]),onClick:t[0]||(t[0]=e=>s.viewMode="monthly")},"月度",2),(0,n.Lk)("button",{class:(0,r.C4)(["segment-button",{active:"yearly"===s.viewMode}]),onClick:t[1]||(t[1]=e=>s.viewMode="yearly")},"年度",2)])])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(d.chartsToRender,(e=>((0,n.uX)(),(0,n.Wv)(u,{key:e.id,chart:e,returnData:a.returnData,config:a.config,viewMode:s.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}const s=e=>((0,n.Qi)("data-v-11096ffc"),e=e(),(0,n.jt)(),e),d={class:"chart-container"},u={class:"controls-wrap"},h={class:"chart-controls"},g={class:"time-legend-row"},p=s((()=>(0,n.Lk)("label",{class:"year-label"},"滑动时间",-1))),v={class:"chart-card"};function C(e,t,a,l,o,i){const c=(0,n.g2)("el-slider"),s=(0,n.g2)("ChartView");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",u,[(0,n.Lk)("div",h,[(0,n.Lk)("button",{class:(0,r.C4)(["chart-button",{"is-active":"bar"===l.currentChartType&&!l.isHorizontal}]),onClick:t[0]||(t[0]=e=>l.setChartType("bar",!1))}," 柱状图 ",2),(0,n.Lk)("button",{class:(0,r.C4)(["chart-button",{"is-active":"bar"===l.currentChartType&&l.isHorizontal}]),onClick:t[1]||(t[1]=e=>l.setChartType("bar",!0))}," 条形图 ",2),(0,n.Lk)("button",{class:(0,r.C4)(["chart-button",{"is-active":"line"===l.currentChartType&&!l.isHorizontal}]),onClick:t[2]||(t[2]=e=>l.setChartType("line",!1))}," 折线图 ",2)]),(0,n.Lk)("div",g,[p,(0,n.bF)(c,{modelValue:l.yearLimit,"onUpdate:modelValue":t[3]||(t[3]=e=>l.yearLimit=e),min:1,max:20,step:1,"show-tooltip":"","format-tooltip":l.formatTooltip,class:"year-slider"},null,8,["modelValue","format-tooltip"]),(0,n.Lk)("button",{class:"toggle-legend-btn",style:(0,r.Tr)({backgroundColor:l.legendAllSelected?"#0bc2d6":"#ccc"}),onClick:t[4]||(t[4]=(...e)=>l.toggleAllLegends&&l.toggleAllLegends(...e))},(0,r.v_)(l.legendAllSelected?"一键未选":"一键全选"),5)])]),(0,n.Lk)("div",v,[(0,n.bF)(s,{ref:"chartRef",option:l.chartOption,initSelectAll:l.legendAllSelected,onLegendStateChange:t[5]||(t[5]=e=>l.legendAllSelected=e)},null,8,["option","initSelectAll"])])])}var y=a(144);const f={ref:"chartContainer",class:"chart-view"};function b(e,t,a,r,l,o){return(0,n.uX)(),(0,n.CE)("div",f,null,512)}var m=a(2212),w=a(2563),L=a(3757),A=a(9922),k=a(8885),T=a(9536),S=a(4016),M=a(1493),O=a(373),D=a(6301);m.Y([k.a,T.a,S.a,L.a,A.a,M.a]);var E={name:"ChartView",props:{option:{type:Object,required:!0},initSelectAll:{type:Boolean,default:!0}},emits:["legendStateChange"],setup(e,{expose:t,emit:a}){const r=(0,y.KR)(null);let l=null,o=null;const i=()=>{if(!r.value||!e.option?.series?.length)return;l&&(l.dispose(),l=null),l=w.Ts(r.value),l.setOption(e.option,!0);const t=l.getOption().legend?.[0]?.data||[];t.forEach((t=>{l.dispatchAction({type:e.initSelectAll?"legendSelect":"legendUnSelect",name:t})})),l.on("legendselectchanged",(e=>{const t=Object.values(e.selected).every((e=>!0===e)),n=Object.values(e.selected).every((e=>!1===e));t?a("legendStateChange",!0):n&&a("legendStateChange",!1)})),o=(0,D.A)((()=>l?.resize()),200),window.addEventListener("resize",o)},c=e=>{l?e?.series?.length&&(O.v.debug("更新了chart"),l.setOption(e,!1)):i()},s=e=>{if(!l)return;const t=l.getOption().legend?.[0]?.data||[];t.forEach((t=>{l.dispatchAction({type:e?"legendSelect":"legendUnSelect",name:t})}))};return(0,n.sV)(i),(0,n.wB)((()=>e.option),c,{deep:!0}),(0,n.xo)((()=>{o&&(window.removeEventListener("resize",o),o.cancel()),l?.dispose(),l=null})),t({toggleAllLegends:s}),{chartContainer:r}}},R=a(1241);const V=(0,R.A)(E,[["render",b],["__scopeId","data-v-1680196d"]]);var j=V,z=a(5e3),K={name:"ChartContainer",components:{ChartView:j},props:{chart:{type:Object,required:!0},returnData:{type:Object,required:!0,default:()=>({})},config:{type:Object,default:()=>({})},viewMode:{type:String,default:"monthly"}},setup(e){const t=(0,y.KR)("bar"),a=(0,y.KR)(!1),r=(0,y.KR)(10),l=(0,y.KR)(!0),o=(0,y.KR)(null),i=t=>"yearly"===e.viewMode?`近 ${t} 年`:`近 ${t} 月`,c=(0,n.EW)((()=>{const n={data:e.returnData,title:e.chart.title||"默认标题",subtitle:e.chart.subtitle||"",zbcodeArr:e.chart.zbcodeArr||[],cityCodeArr:e.config.cityCodeArr||[],dbCode:e.chart.dbCode||"nd",unit:e.chart.unit||"",exceptName:e.chart.exceptName||"",legendTop:e.chart.legendTop,gridTop:e.chart.gridTop,chartType:t.value,yearLimit:r.value,isHorizontal:a.value};return O.v.debug("调用 getCommonChartOption 的参数:",n),(0,z.HM)(n)})),s=(e,n)=>{t.value=e,a.value=n},d=()=>{l.value=!l.value,o.value&&o.value.toggleAllLegends(l.value)};return{currentChartType:t,isHorizontal:a,yearLimit:r,legendAllSelected:l,chartOption:c,setChartType:s,toggleAllLegends:d,formatTooltip:i,chartRef:o}}};const X=(0,R.A)(K,[["render",C],["__scopeId","data-v-11096ffc"]]);var _=X,H={components:{ChartContainer:_},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")&&e.has("nd")},defaultViewMode(){const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")?"monthly":e.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((e=>"monthly"===this.viewMode?"yd"===e.dbCode:"nd"===e.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((e=>{const t=this.returnData?.dataList?.sj?.[e.dbCode];return Array.isArray(t)&&t.length>0}))}},created(){this.viewMode=this.defaultViewMode}};const x=(0,R.A)(H,[["render",c],["__scopeId","data-v-ce7a7c4e"]]);var I=x}}]);
//# sourceMappingURL=1825.95f02294.js.map