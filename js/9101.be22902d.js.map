{"version":3,"file":"js/9101.be22902d.js","mappings":"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","sources":["webpack://tangdata/./src/components/common/ChartPage.vue","webpack://tangdata/./src/components/common/ChartContainer.vue","webpack://tangdata/./src/components/common/ChartView.vue","webpack://tangdata/./src/components/common/ChartView.vue?7c38","webpack://tangdata/./src/components/common/ChartContainer.vue?9df1","webpack://tangdata/./src/components/common/ChartPage.vue?6ceb"],"sourcesContent":["<template>\n  <div class=\"echart-container\">\n    <div v-if=\"internalShowToggles\" class=\"segment-container\">\n      <div class=\"segment-wrapper\">\n        <div class=\"segment-bg\" :class=\"viewMode\"></div>\n        <button class=\"segment-button\" :class=\"{ active: viewMode === 'monthly' }\"\n          @click=\"viewMode = 'monthly'\">月度</button>\n        <button class=\"segment-button\" :class=\"{ active: viewMode === 'yearly' }\"\n          @click=\"viewMode = 'yearly'\">年度</button>\n      </div>\n    </div>\n\n    <ChartContainer v-for=\"chart in chartsToRender\" :key=\"chart.id\" :chart=\"chart\" :returnData=\"returnData\"\n      :config=\"config\" :viewMode=\"viewMode\" />\n  </div>\n</template>\n\n<script>\nimport ChartContainer from './ChartContainer.vue';\n\nexport default {\n  components: { ChartContainer },\n  props: {\n    chartMetaList: Array,\n    returnData: Object,\n    config: Object,\n    showToggles: { type: Boolean, default: true },\n  },\n  data() {\n    return {\n      viewMode: 'monthly',\n    };\n  },\n  computed: {\n    internalShowToggles() {\n      if (!this.showToggles) return false;\n      const dbCodes = new Set(this.chartMetaList.map((c) => c.dbCode));\n      return dbCodes.has('yd') && dbCodes.has('nd');\n    },\n    defaultViewMode() {\n      const dbCodes = new Set(this.chartMetaList.map((c) => c.dbCode));\n      if (dbCodes.has('yd')) return 'monthly';\n      if (dbCodes.has('nd')) return 'yearly';\n      return 'monthly';\n    },\n    filteredCharts() {\n      if (!this.internalShowToggles) return this.chartMetaList;\n      return this.chartMetaList.filter((c) =>\n        this.viewMode === 'monthly' ? c.dbCode === 'yd' : c.dbCode === 'nd'\n      );\n    },\n    chartsToRender() {\n      return this.filteredCharts.filter((chart) => {\n        const sj = this.returnData?.sj?.[chart.dbCode];\n        return Array.isArray(sj) && sj.length > 0;\n      });\n    },\n  },\n  created() {\n    this.viewMode = this.defaultViewMode;\n  },\n};\n</script>\n\n<style scoped>\n.segment-container {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  margin-top: 10px;\n\n}\n\n.segment-wrapper {\n  position: relative;\n  display: flex;\n  width: 200px;\n  height: 45px;\n  background-color: #fff;\n  border-radius: 15px;\n  padding: 2px;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  /* ✅ 外部阴影更明显 */\n}\n\n/* 背景高亮滑块 */\n.segment-bg {\n  position: absolute;\n  top: 2px;\n  bottom: 2px;\n  width: 50%;\n  border-radius: 15px;\n  background-color: #0bc2d6;\n  transition: left 0.25s ease;\n  z-index: 0;\n}\n\n.segment-bg.monthly {\n  left: 2px;\n}\n\n.segment-bg.yearly {\n  left: 50%;\n}\n\n/* 按钮本体 */\n.segment-button {\n  position: relative;\n  flex: 1;\n  z-index: 1;\n  border: none;\n  outline: none;\n  background: transparent;\n  color: #333;\n  font-size: 14px;\n  font-weight: 500;\n  border-radius: 15px;\n  cursor: pointer;\n  transition: color 0.25s ease;\n}\n\n.segment-button.active {\n  color: #fff;\n}\n\n\n</style>","<template>\n  <div class=\"chart-container\">\n    <div class=\"controls-wrap\">\n      <!-- PC端布局 - 所有控件在一行 -->\n      <div class=\"controls-row\">\n        <!-- 图表类型控件 -->\n        <div class=\"chart-controls\">\n          <button :class=\"['chart-button', { 'is-active': currentChartType === 'bar' && !isHorizontal }]\"\n            @click=\"setChartType('bar', false)\">\n            柱状图\n          </button>\n          <button :class=\"['chart-button', { 'is-active': currentChartType === 'bar' && isHorizontal }]\"\n            @click=\"setChartType('bar', true)\">\n            条形图\n          </button>\n          <button :class=\"['chart-button', { 'is-active': currentChartType === 'line' && !isHorizontal }]\"\n            @click=\"setChartType('line', false)\">\n            折线图\n          </button>\n        </div>\n        \n        <!-- 一键全选控件 - 与图表类型按钮在同一行 -->\n        <button class=\"toggle-legend-btn\" :style=\"{ backgroundColor: legendAllSelected ? '#0bc2d6' : '#ccc' }\"\n          @click=\"toggleAllLegends\">\n          {{ legendAllSelected ? '一键未选' : '一键全选' }}\n        </button>\n        \n        <!-- 时间选择控件 -->\n        <div class=\"time-control\">\n          <label class=\"year-label\">选择时间:</label>\n          <el-slider v-model=\"yearLimit\" :min=1 :max=20 :step=1 class=\"year-slider\" />\n          <span class=\"offset-value\">{{ yearLimit }}</span>\n        </div>\n      </div>\n      \n      <!-- 折线图模式下第二行控件 -->\n      <div v-if=\"currentChartType === 'line' && !isHorizontal\" class=\"line-mode-controls\">\n        <div class=\"legend-control\">\n          <el-select v-model=\"selectedLegend\" placeholder=\"选择图例\" class=\"legend-selector\">\n            <el-option v-for=\"legend in legendList\" :key=\"legend\" :label=\"legend\" :value=\"legend\" />\n          </el-select>\n        </div>\n        \n        <div class=\"offset-controls\">\n          <label class=\"year-label\">折线偏移:</label>\n          <div class=\"offset-slider-container\">\n            <el-slider v-model=\"offsetValue\" :min=-20 :max=20 :step=1 class=\"year-slider\" />\n            <span class=\"offset-value\">{{ offsetValue }}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"chart-card\">\n      <ChartView ref=\"chartRef\" :option=\"chartOption\" :chartId=\"chart.id\" :initSelectAll=\"legendAllSelected\"\n        @legendStateChange=\"legendAllSelected = $event\" />\n    </div>\n  </div>\n</template>\n\n\n<script>\nimport { ref, computed, watch } from 'vue';\nimport ChartView from './ChartView.vue';\nimport { getCommonChartOption } from '@/utils/CommonUtil.js';\nimport { logger } from '@/utils/Logger.js';\n\nexport default {\n  name: 'ChartContainer',\n  components: { ChartView },\n  props: {\n    chart: { type: Object, required: true },\n    returnData: { type: Object, required: true, default: () => ({}) },\n    config: { type: Object, default: () => ({}) },\n    viewMode: { type: String, default: 'monthly' }\n  },\n  setup(props) {\n    const currentChartType = ref('bar');\n    const isHorizontal = ref(false);\n    const yearLimit = ref(10);\n    const legendAllSelected = ref(true);\n    const chartRef = ref(null);\n    // 新增状态\n    const selectedLegend = ref(null)\n    const offsetValue = ref(0)\n    const legendNames = ref([])\n\n\n   // 必须这么写，不然在上面使用legendNames取不到数据，使用legendNames.value写法又报错\n    const legendList = computed(() => legendNames.value)\n\n    const chartOption = computed(() => {\n\n      const chartConfig = {\n        data: props.returnData,\n        title: props.chart.title || '默认标题',\n        subtitle: props.chart.subtitle || '',\n        zbcodeArr: props.chart.zbcodeArr || [],\n        cityCodeArr: props.config.cityCodeArr || [],\n        dbCode: props.chart.dbCode || 'nd',\n        unit: props.chart.unit || '',\n        exceptName: props.chart.exceptName || '',\n        legendTop: props.chart.legendTop,\n        gridTop: props.chart.gridTop,\n        chartType: currentChartType.value,\n        yearLimit: yearLimit.value,\n        isHorizontal: isHorizontal.value,\n        enableBirthOffset: props.chart.enableBirthOffset || false,\n        enableBirthPrediction: props.chart.enableBirthPrediction || false,\n        selectedLegend: selectedLegend.value,\n        offsetValue: offsetValue.value\n      };\n\n      const option = getCommonChartOption(chartConfig);\n\n      return option;\n    });\n\n\n    // 监听 legendNames，初始化选中第一个\n    // ✅ 在 watch 里同步 legend，不会报 eslint 错\n    // watch returnData 或 chartOption 更新 legendNames\n    watch(chartOption, async (newOption) => {\n\n      legendNames.value = newOption?.legend?.data || []\n      // 默认选中第一个 legend\n      if (!selectedLegend.value && legendNames.value.length > 0) {\n        selectedLegend.value = legendNames.value[0]\n      }\n\n    }, { immediate: true })\n\n    // 切换图表类型\n    const setChartType = (type, horizontal) => {\n      currentChartType.value = type;\n      isHorizontal.value = horizontal;\n    };\n\n    // 一键全选/未选\n    const toggleAllLegends = () => {\n      logger.debug('一键全选:', legendAllSelected.value);\n      legendAllSelected.value = !legendAllSelected.value;\n      if (chartRef.value) {\n        chartRef.value.toggleAllLegends(legendAllSelected.value);\n      }\n    };\n\n    return {\n      currentChartType,\n      isHorizontal,\n      yearLimit,\n      legendAllSelected,\n      chartOption,\n      setChartType,\n      toggleAllLegends,\n      chartRef,\n      selectedLegend,\n      offsetValue,\n      legendList\n    };\n  }\n};\n</script>\n\n\n<style scoped>\n.chart-container {\n  width: 95%;\n  max-width: 1500px;\n  margin: 30px auto 60px;\n  padding: 16px;\n  background-color: #fff;\n  border-radius: 12px;\n  box-shadow: 0 0 8px rgba(0, 0, 0, 0.06);\n  box-sizing: border-box;\n}\n\n.controls-wrap {\n  display: flex;\n  flex-direction: column;\n  width: fit-content;\n  margin: 0 auto;\n}\n\n.controls-row {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: center;\n  gap: 16px;\n  margin-top: 16px;\n}\n\n.chart-controls {\n  display: flex;\n  gap: 12px;\n}\n\n.time-control {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.legend-control {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.offset-controls {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.line-mode-controls {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 20px;\n  margin-top: 30px;\n  width: 100%;\n}\n\n.year-label {\n  font-weight: 400;\n  flex-shrink: 0;\n  padding: 8px 14px; /* PC端增大尺寸 */\n  font-size: 18px; /* PC端增大字体 */\n  /* color: rgb(113, 109, 109); */\n  border-radius: 8px;\n}\n\n.year-slider {\n  min-width: 150px; /* PC端增大宽度 */\n  max-width: 250px; /* PC端增大宽度 */\n}\n\n.toggle-legend-btn {\n  flex-shrink: 0;\n  padding: 8px 14px; /* PC端增大尺寸 */\n  font-size: 14px; /* PC端增大字体 */\n  color: #fff;\n  background-color: #0bc2d6;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s;\n  display: inline-flex;\n  align-items: center;\n}\n\n.toggle-legend-btn:active {\n  transform: scale(0.98);\n}\n\n.chart-button {\n  padding: 8px 14px; /* PC端增大尺寸 */\n  font-size: 14px; /* PC端增大字体 */\n  color: #fff;\n  background-color: #ccc;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: background 0.3s;\n}\n\n.chart-button.is-active {\n  background-color: #0bc2d6;\n}\n\n.chart-card {\n  width: 95%;\n  height: 700px;\n  margin: 0 auto;\n  margin-top: 20px;\n}\n\n.legend-selector {\n  width: 100%;\n  min-width: 250px;\n  max-width: 350px;\n}\n\n.offset-slider-container {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.offset-value {\n  flex-shrink: 0;\n  min-width: 30px;\n  font-size: 14px;\n  color: #606266;\n  text-align: center;\n}\n\n@media (max-width: 768px) {\n  .controls-row {\n    flex-direction: row;\n    flex-wrap: wrap;\n    justify-content: center;\n    gap: 6px;\n    margin-top: 8px;\n  }\n  \n  .chart-controls {\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n    gap: 6px;\n    margin-bottom: 0;\n  }\n  \n  .toggle-legend-btn {\n    margin: 0;\n    padding: 6px 10px;\n    font-size: 12px;\n  }\n  \n  /* 时间控件优化 */\n  .time-control {\n    width: 100%;\n    justify-content: center;\n    margin-top: 8px;\n    flex-wrap: nowrap;\n    /* background-color: #f8f9fa; */\n    padding: 4px 8px;\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n  }\n  \n  .time-control .year-label {\n    padding: 4px 4px;\n    font-size: 13px;\n    flex-shrink: 0;\n  }\n  \n  .time-control .year-slider {\n    min-width: 100px;\n    max-width: 150px;\n    flex-grow: 1;\n  }\n  \n  .legend-selector {\n    max-width: 120px; /* 进一步减小图例选择框宽度 */\n    min-width: auto;\n  }\n  \n  .chart-card {\n    height: 500px;\n  }\n  \n  /* 图例选择框和偏移控件布局优化 */\n  .line-mode-controls {\n    flex-direction: row;\n    flex-wrap: nowrap;\n    gap: 8px;\n    margin-top: 8px;\n    justify-content: center;\n    align-items: center;\n    /* background-color: #f8f9fa; */\n    padding: 6px;\n    border-radius: 8px;\n    width: 100%;\n  }\n  \n  .legend-control {\n    flex: 1;\n    min-width: 50px;\n    max-width: 34%; /* 限制最大宽度 */\n    justify-content: center;\n  }\n  \n  .offset-controls {\n    flex: 1;\n    min-width: 150px;\n    max-width: 80%; /* 限制最大宽度 */\n    justify-content: center;\n  }\n  \n  /* 偏移控件内部优化 */\n  .offset-controls {\n    display: flex;\n    flex-wrap: nowrap;\n    align-items: center;\n    gap: 6px;\n  }\n  \n  .offset-slider-container {\n    display: flex;\n    flex-wrap: nowrap;\n    align-items: center;\n    gap: 4px;\n    flex-grow: 1;\n  }\n  \n  .offset-controls .year-slider {\n    min-width: 120px; /* 减小滑块最小宽度 */\n    max-width: 200px; /* 减小滑块最大宽度 */\n    flex-grow: 1;\n  }\n  \n  .year-label {\n    padding: 4px 8px;\n    font-size: 13px;\n    white-space: nowrap;\n    flex-shrink: 0;\n  }\n  \n  .chart-button {\n    padding: 6px 10px;\n    font-size: 12px;\n  }\n  \n  .offset-value {\n    font-size: 12px;\n    min-width: 25px;\n    flex-shrink: 0;\n  }\n  \n  /* 添加间距 */\n  .legend-control {\n    margin-right: 8px; /* 图例选择框右侧添加间距 */\n  }\n}\n\n/* 滑块样式覆盖 */\n::v-deep(.el-slider__bar) {\n  background-color: #0bc2d6 !important;\n}\n\n::v-deep(.el-slider__button) {\n  background-color: #0bc2d6 !important;\n  border-color: #0bc2d6 !important;\n}\n\n/* 选legend择框圆角 */\n::v-deep(.legend-selector .el-select__wrapper) {\n  border-radius: 6px !important;\n}\n\n::v-deep(.legend-selector .el-select__tags) {\n  border-radius: 6px !important;\n}\n</style>","<template>\n  <div ref=\"chartContainer\" class=\"chart-view\"></div>\n</template>\n\n<script>\nimport { ref, onMounted, onBeforeUnmount, watch, nextTick } from 'vue';\nimport * as echarts from 'echarts/core';\nimport { BarChart, LineChart } from 'echarts/charts';\nimport { TitleComponent,GridComponent, TooltipComponent, LegendComponent } from 'echarts/components';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { logger } from '@/utils/Logger.js';\nimport debounce from 'lodash-es/debounce';\n\necharts.use([TitleComponent,GridComponent, TooltipComponent, LegendComponent, BarChart, LineChart, CanvasRenderer]);\n\nexport default {\n  name: 'ChartView',\n  props: {\n    option: { type: Object, required: true },\n    chartId: { type: String, required: true }, // 从 ChartContainer 传入\n    initSelectAll: { type: Boolean, default: true }\n  },\n  emits: ['legendStateChange'],\n  setup(props, { expose, emit }) {\n    const chartContainer = ref(null);\n    let chartInstance = null;\n    let resizeHandler = null;\n\n    const initChart = () => {\n      if (!chartContainer.value || !props.option?.series?.length) return;\n\n      const startTime = performance.now();\n\n      // 如果实例已存在且未销毁，直接更新\n      if (chartInstance && !chartInstance.isDisposed()) {\n        updateChart(props.option);\n        return;\n      }\n\n      // 创建新实例\n      chartInstance = echarts.init(chartContainer.value);\n      chartInstance.setOption(props.option, true);\n\n      // 初始化图例状态\n      const legends = chartInstance.getOption().legend?.[0]?.data || [];\n      if (legends.length > 0) {\n        legends.forEach(name => {\n          chartInstance.dispatchAction({\n            type: props.initSelectAll ? 'legendSelect' : 'legendUnSelect',\n            name\n          });\n        });\n      }\n\n      // 绑定事件（只绑定一次）\n      chartInstance.on('legendselectchanged', (params) => {\n        const allSelected = Object.values(params.selected).every(v => v === true);\n        const noneSelected = Object.values(params.selected).every(v => v === false);\n\n        if (allSelected) emit('legendStateChange', true);\n        else if (noneSelected) emit('legendStateChange', false);\n      });\n\n      // 绑定窗口大小调整事件\n      if (!resizeHandler) {\n        resizeHandler = debounce(() => {\n          if (chartInstance && !chartInstance.isDisposed()) {\n            chartInstance.resize();\n          }\n        }, 200);\n        window.addEventListener('resize', resizeHandler);\n      }\n\n      const endTime = performance.now();\n      logger.debug(`[Chart ${props.chartId}] 图表初始化耗时: ${Math.round(endTime - startTime)}ms`);\n    };\n\n    const updateChart = (newOption) => {\n      if (!chartInstance || chartInstance.isDisposed()) {\n        initChart();\n        return;\n      }\n      if (!newOption?.series?.length) return;\n      logger.debug('updateChart方法调用')\n      // 使用增量更新，提高性能\n      chartInstance.setOption(newOption, false, true);\n    };\n\n    const toggleAllLegends = (selectAll) => {\n      if (!chartInstance) return;\n      const legends = chartInstance.getOption().legend?.[0]?.data || [];\n      const startTime = performance.now();\n      legends.forEach(name => {\n        chartInstance.dispatchAction({\n          type: selectAll ? 'legendSelect' : 'legendUnSelect',\n          name\n        });\n      });\n      const endTime = performance.now();\n      logger.debug(`[Chart ${props.chartId}] toggleAllLegends耗时: ${Math.round(endTime - startTime)}ms`);\n    };\n\n    onMounted(() => {\n      nextTick(() => initChart());\n    });\n\n    // 使用浅监听，避免深度监听的性能开销\n    watch(() => props.option, updateChart, { deep: false });\n\n    onBeforeUnmount(() => {\n      if (resizeHandler) {\n        window.removeEventListener('resize', resizeHandler);\n        resizeHandler.cancel();\n      }\n      chartInstance?.dispose();\n      chartInstance = null;\n    });\n\n    expose({ toggleAllLegends });\n\n    return { chartContainer };\n  }\n};\n</script>\n\n<style scoped>\n.chart-view {\n  width: 100%;\n  height: 100%;\n}\n</style>","import { render } from \"./ChartView.vue?vue&type=template&id=6bfb044d&scoped=true\"\nimport script from \"./ChartView.vue?vue&type=script&lang=js\"\nexport * from \"./ChartView.vue?vue&type=script&lang=js\"\n\nimport \"./ChartView.vue?vue&type=style&index=0&id=6bfb044d&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-6bfb044d\"]])\n\nexport default __exports__","import { render } from \"./ChartContainer.vue?vue&type=template&id=578fa3e6&scoped=true\"\nimport script from \"./ChartContainer.vue?vue&type=script&lang=js\"\nexport * from \"./ChartContainer.vue?vue&type=script&lang=js\"\n\nimport \"./ChartContainer.vue?vue&type=style&index=0&id=578fa3e6&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-578fa3e6\"]])\n\nexport default __exports__","import { render } from \"./ChartPage.vue?vue&type=template&id=4658eebb&scoped=true\"\nimport script from \"./ChartPage.vue?vue&type=script&lang=js\"\nexport * from \"./ChartPage.vue?vue&type=script&lang=js\"\n\nimport \"./ChartPage.vue?vue&type=style&index=0&id=4658eebb&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-4658eebb\"]])\n\nexport default __exports__"],"names":["class","key","_createElementBlock","_hoisted_1","$options","internalShowToggles","_hoisted_2","_createElementVNode","_hoisted_3","_normalizeClass","$data","viewMode","active","onClick","_cache","$event","_createCommentVNode","_Fragment","_renderList","chartsToRender","chart","_createBlock","_component_ChartContainer","id","returnData","$props","config","_hoisted_4","$setup","currentChartType","isHorizontal","setChartType","style","_normalizeStyle","backgroundColor","legendAllSelected","args","toggleAllLegends","_hoisted_5","_hoisted_6","_createVNode","_component_el_slider","modelValue","yearLimit","min","max","step","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","_component_el_select","selectedLegend","placeholder","default","_withCtx","legendList","legend","_component_el_option","label","value","_","_hoisted_10","_hoisted_11","_hoisted_12","offsetValue","_hoisted_13","_hoisted_14","_component_ChartView","ref","option","chartOption","chartId","initSelectAll","onLegendStateChange","echarts","TitleComponent","GridComponent","TooltipComponent","LegendComponent","BarChart","LineChart","CanvasRenderer","name","props","type","Object","required","String","Boolean","emits","setup","expose","emit","chartContainer","chartInstance","resizeHandler","initChart","series","length","startTime","performance","now","isDisposed","updateChart","setOption","legends","getOption","data","forEach","dispatchAction","on","params","allSelected","values","selected","every","v","noneSelected","debounce","resize","window","addEventListener","endTime","logger","debug","Math","round","newOption","selectAll","onMounted","nextTick","watch","deep","onBeforeUnmount","removeEventListener","cancel","dispose","__exports__","components","ChartView","chartRef","legendNames","computed","chartConfig","title","subtitle","zbcodeArr","cityCodeArr","dbCode","unit","exceptName","legendTop","gridTop","chartType","enableBirthOffset","enableBirthPrediction","getCommonChartOption","async","immediate","horizontal","ChartContainer","chartMetaList","Array","showToggles","this","dbCodes","Set","map","c","has","defaultViewMode","filteredCharts","filter","sj","isArray","created","render"],"sourceRoot":""}