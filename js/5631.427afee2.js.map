{"version":3,"file":"js/5631.427afee2.js","mappings":"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","sources":["webpack://tangdata/./src/components/common/ChartCard.vue","webpack://tangdata/./src/components/common/ChartCard.vue?7a80","webpack://tangdata/./src/components/common/ChartView.vue","webpack://tangdata/./src/components/common/ChartView.vue?7c38"],"sourcesContent":["<template>\n  <div class=\"chart-card\">\n    <ChartView :option=\"chartOption\" class=\"chart-wrapper\" />\n  </div>\n</template>\n\n<script>\nimport ChartView from './ChartView.vue';\nimport { getCommonChartOption } from '@/utils/CommonUtil.js';\n\nexport default {\n  components: { ChartView },\n  props: {\n    chart: Object,\n    returnData: Object,\n    config: Object,\n    chartType: String, // 'bar' 或 'line'\n    yearLimit: {\n      type: Number,\n      default: 10\n    },\n    isHorizontal: Boolean,\n  },\n  computed: {\n    adjustedLegendTop() {\n      const baseTop = this.chart.legendTop || '15%';\n\n      // 处理字符串百分比\n      if (window.innerWidth <= 768) { // 移动端\n        if (typeof baseTop === 'string' && baseTop.endsWith('%')) {\n          const num = parseFloat(baseTop);\n          return (num / 3) + '%'; // 缩小为原来的三分之一\n        }\n        if (typeof baseTop === 'number') {\n          return baseTop / 3; // 数值缩小\n        }\n        return '5%'; // 默认值\n      }\n      // PC端正常返回\n      return baseTop;\n    },\n\n    chartOption() {\n      const params = {\n        // 只取必要字段，避免污染\n        data: this.returnData,\n        cityCodeArr: this.config?.cityCodeArr || [],\n        // 图表相关\n        title: this.chart.title,\n        subtitle: this.chart.subtitle,\n        dbCode: this.chart.dbCode,\n        zbcodeArr: this.chart.zbcodeArr,\n        unit: this.chart.unit,\n        exceptName: this.chart.exceptName,\n        legendTop: this.adjustedLegendTop,\n        gridTop: this.chart.gridTop,\n        echrtId: this.chart.id,\n        chartType: this.chartType,\n        yearLimit: this.yearLimit,\n        isHorizontal: this.isHorizontal,\n        \n      };\n      const option = getCommonChartOption(params);\n\n      if (option.title) delete option.title; // 防止重复标题显示\n\n      return option;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.chart-card {\n  width: 95%;\n  height: 600px;\n  margin: 0 auto;\n}\n\n.chart-wrapper {\n  width: 100%;\n  height: 100%;\n}\n</style>","import { render } from \"./ChartCard.vue?vue&type=template&id=634bd65e&scoped=true\"\nimport script from \"./ChartCard.vue?vue&type=script&lang=js\"\nexport * from \"./ChartCard.vue?vue&type=script&lang=js\"\n\nimport \"./ChartCard.vue?vue&type=style&index=0&id=634bd65e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-634bd65e\"]])\n\nexport default __exports__","<template>\n  <div ref=\"chartContainer\" class=\"chart-view\"></div>\n</template>\n\n<script>\nimport { ref, onMounted, onBeforeUnmount, watch, nextTick } from 'vue';\nimport * as echarts from 'echarts';\n\nexport default {\n  name: 'ChartView',\n  props: {\n    option: {\n      type: Object,\n      required: true\n    },\n    debug: { // 可在父组件临时传 debug=true 打开更多日志\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(props) {\n    const chartContainer = ref(null);\n    let chartInstance = null;\n    let resizeObserver = null;\n    let initCount = 0;\n    let disposeCount = 0;\n    let setOptionCount = 0;\n\n    const log = (...args) => {\n      if (props.debug) {\n        console.log('[ChartView]', ...args);\n      }\n    };\n\n    const initChart = () => {\n      if (!chartContainer.value) return;\n\n      if (!chartInstance) {\n        initCount++;\n        console.time(`echarts-init-${initCount}`);\n        chartInstance = echarts.init(chartContainer.value);\n        console.timeEnd(`echarts-init-${initCount}`);\n        log(`init #${initCount} (container):`, chartContainer.value);\n\n        // resize 监听\n        window.addEventListener('resize', resizeChart);\n\n        resizeObserver = new ResizeObserver(() => {\n          if (chartInstance) {\n            chartInstance.resize();\n          }\n        });\n        resizeObserver.observe(chartContainer.value);\n      }\n\n      // 首次初始化后，如果已有 option 立即 setOption 一次\n      if (props.option && Object.keys(props.option).length > 0) {\n        applyOption(props.option);\n      }\n    };\n\n    const applyOption = (opt) => {\n      if (!chartInstance) return;\n      setOptionCount++;\n      const label = `echarts-setOption-${setOptionCount}`;\n      console.time(label);\n      // 第2个参数 notMerge = false 保留合并逻辑（你之前改成 false）\n      // 第3个参数 lazyUpdate = true 尽量降低同步更新开销（可观察效果）\n      try {\n        chartInstance.setOption(opt, false, true);\n      } catch (e) {\n        console.error('[ChartView] setOption error', e);\n      }\n      console.timeEnd(label);\n      log(`setOption count=${setOptionCount}`);\n    };\n\n    const resizeChart = () => {\n      if (chartInstance) {\n        chartInstance.resize();\n      }\n    };\n\n    onMounted(async () => {\n      await nextTick();\n      log('onMounted');\n      initChart();\n    });\n\n    watch(\n      () => props.option,\n      (newOption) => {\n        if (newOption && Object.keys(newOption).length > 0) {\n          // 给出更多日志：测量从 watch 到 setOption 的时间\n          const t0 = performance.now();\n          applyOption(newOption);\n          const t1 = performance.now();\n          log(`watch->applyOption elapsed ${(t1 - t0).toFixed(1)} ms`);\n        }\n      },\n      { deep: true }\n    );\n\n    onBeforeUnmount(() => {\n      disposeCount++;\n      console.time(`echarts-dispose-${disposeCount}`);\n      window.removeEventListener('resize', resizeChart);\n\n      if (resizeObserver && chartContainer.value) {\n        try {\n          resizeObserver.unobserve(chartContainer.value);\n          resizeObserver.disconnect();\n        } catch (e) { /* ignore */ }\n        resizeObserver = null;\n      }\n\n      if (chartInstance) {\n        try {\n          chartInstance.dispose();\n        } catch (e) { /* ignore */ }\n        chartInstance = null;\n      }\n      console.timeEnd(`echarts-dispose-${disposeCount}`);\n      log('onBeforeUnmount, disposeCount=', disposeCount);\n    });\n\n    return {\n      chartContainer\n    };\n  }\n};\n</script>\n\n<style scoped>\n.chart-view {\n  width: 100%;\n  height: 100%;\n}\n</style>","import { render } from \"./ChartView.vue?vue&type=template&id=4a7cde61&scoped=true\"\nimport script from \"./ChartView.vue?vue&type=script&lang=js\"\nexport * from \"./ChartView.vue?vue&type=script&lang=js\"\n\nimport \"./ChartView.vue?vue&type=style&index=0&id=4a7cde61&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-4a7cde61\"]])\n\nexport default __exports__"],"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_ChartView","option","$options","chartOption","components","ChartView","props","chart","Object","returnData","config","chartType","String","yearLimit","type","Number","default","isHorizontal","Boolean","computed","adjustedLegendTop","baseTop","this","legendTop","window","innerWidth","endsWith","num","parseFloat","params","data","cityCodeArr","title","subtitle","dbCode","zbcodeArr","unit","exceptName","gridTop","echrtId","id","getCommonChartOption","__exports__","render","ref","name","required","debug","setup","chartContainer","chartInstance","resizeObserver","initCount","disposeCount","setOptionCount","log","args","console","initChart","value","time","echarts","timeEnd","addEventListener","resizeChart","ResizeObserver","resize","observe","keys","length","applyOption","opt","label","setOption","e","error","onMounted","async","nextTick","watch","newOption","t0","performance","now","t1","toFixed","deep","onBeforeUnmount","removeEventListener","unobserve","disconnect","dispose"],"sourceRoot":""}