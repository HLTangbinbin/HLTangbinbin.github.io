"use strict";(self["webpackChunktangdata"]=self["webpackChunktangdata"]||[]).push([[5410],{5410:function(e,t,a){a.d(t,{A:function(){return N}});var n=a(6768),l=a(4232);const r={class:"echart-container"},o={key:0,class:"segment-container"},i={class:"segment-wrapper"};function s(e,t,a,s,c,d){const u=(0,n.g2)("ChartContainer");return(0,n.uX)(),(0,n.CE)("div",r,[d.internalShowToggles?((0,n.uX)(),(0,n.CE)("div",o,[(0,n.Lk)("div",i,[(0,n.Lk)("div",{class:(0,l.C4)(["segment-bg",c.viewMode])},null,2),(0,n.Lk)("button",{class:(0,l.C4)(["segment-button",{active:"monthly"===c.viewMode}]),onClick:t[0]||(t[0]=e=>c.viewMode="monthly")},"月度",2),(0,n.Lk)("button",{class:(0,l.C4)(["segment-button",{active:"yearly"===c.viewMode}]),onClick:t[1]||(t[1]=e=>c.viewMode="yearly")},"年度",2)])])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(d.chartsToRender,(e=>((0,n.uX)(),(0,n.Wv)(u,{key:e.id,chart:e,returnData:a.returnData,config:a.config,viewMode:c.viewMode},null,8,["chart","returnData","config","viewMode"])))),128))])}const c=e=>((0,n.Qi)("data-v-09a8f2e6"),e=e(),(0,n.jt)(),e),d={class:"chart-container"},u={class:"controls-wrap"},h={class:"controls-row"},g={class:"chart-controls"},p={class:"time-control"},v=c((()=>(0,n.Lk)("label",{class:"year-label"},"选择时间:",-1))),f={class:"offset-value"},C={key:0,class:"line-mode-controls"},b={class:"legend-control"},y={class:"offset-controls"},m=c((()=>(0,n.Lk)("label",{class:"year-label"},"折线偏移:",-1))),L={class:"offset-slider-container"},w={class:"offset-value"};function k(e,t,a,r,o,i){const s=(0,n.g2)("el-slider"),c=(0,n.g2)("el-option"),k=(0,n.g2)("el-select"),A=(0,n.g2)("ChartView");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",u,[(0,n.Lk)("div",h,[(0,n.Lk)("div",g,[(0,n.Lk)("button",{class:(0,l.C4)(["chart-button",{"is-active":"bar"===r.currentChartType&&!r.isHorizontal}]),onClick:t[0]||(t[0]=e=>r.setChartType("bar",!1))}," 柱状图 ",2),(0,n.Lk)("button",{class:(0,l.C4)(["chart-button",{"is-active":"bar"===r.currentChartType&&r.isHorizontal}]),onClick:t[1]||(t[1]=e=>r.setChartType("bar",!0))}," 条形图 ",2),(0,n.Lk)("button",{class:(0,l.C4)(["chart-button",{"is-active":"line"===r.currentChartType&&!r.isHorizontal}]),onClick:t[2]||(t[2]=e=>r.setChartType("line",!1))}," 折线图 ",2)]),(0,n.Lk)("button",{class:"toggle-legend-btn",style:(0,l.Tr)({backgroundColor:r.legendAllSelected?"#0bc2d6":"#ccc"}),onClick:t[3]||(t[3]=(...e)=>r.toggleAllLegends&&r.toggleAllLegends(...e))},(0,l.v_)(r.legendAllSelected?"一键未选":"一键全选"),5),(0,n.Lk)("div",p,[v,(0,n.bF)(s,{modelValue:r.yearLimit,"onUpdate:modelValue":t[4]||(t[4]=e=>r.yearLimit=e),min:1,max:30,step:1,class:"year-slider"},null,8,["modelValue"]),(0,n.Lk)("span",f,(0,l.v_)(r.yearLimit),1)])]),"line"!==r.currentChartType||r.isHorizontal?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",C,[(0,n.Lk)("div",b,[(0,n.bF)(k,{modelValue:r.selectedLegend,"onUpdate:modelValue":t[5]||(t[5]=e=>r.selectedLegend=e),placeholder:"选择图例",class:"legend-selector"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.legendList,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,n.Lk)("div",y,[m,(0,n.Lk)("div",L,[(0,n.bF)(s,{modelValue:r.offsetValue,"onUpdate:modelValue":t[6]||(t[6]=e=>r.offsetValue=e),min:-30,max:30,step:1,class:"year-slider"},null,8,["modelValue"]),(0,n.Lk)("span",w,(0,l.v_)(r.offsetValue),1)])])]))]),(0,n.Lk)("div",{class:"chart-card",style:(0,l.Tr)({height:r.chartHeight+"px"})},[(0,n.bF)(A,{ref:"chartRef",option:r.chartOption,chartId:a.chart.id,initSelectAll:r.legendAllSelected,pieConfig:a.chart.pieConfig,onLegendStateChange:t[7]||(t[7]=e=>r.legendAllSelected=e)},null,8,["option","chartId","initSelectAll","pieConfig"])],4)])}var A=a(144);const S={ref:"chartContainer",class:"chart-view"};function T(e,t,a,l,r,o){return(0,n.uX)(),(0,n.CE)("div",S,null,512)}var M=a(2212),V=a(1309),O=a(9839),E=a(2297),R=a(9848),z=a(623),K=a(9372),j=a(9536),I=a(5143),_=a(1493),D=a(373),x=a(6301);M.Y([z.a,K.a,j.a,I.a,O.a,E.a,R.a,_.a]);var H={name:"ChartView",props:{option:{type:Object,required:!0},chartId:{type:String,required:!0},pieConfig:{type:Object,default:()=>({})},initSelectAll:{type:Boolean,default:!0}},emits:["legendStateChange"],setup(e,{expose:t,emit:a}){const l=(0,A.KR)(null);let r=null,o=null;const i=()=>{if(!l.value||!e.option?.series?.length)return;const t=performance.now();if(r&&!r.isDisposed())return void s(e.option);r=V.Ts(l.value),r.setOption(e.option,!0);const n=r.getOption().legend?.[0]?.data||[];n.length>0&&n.forEach((t=>{r.dispatchAction({type:e.initSelectAll?"legendSelect":"legendUnSelect",name:t})})),r.on("legendselectchanged",(e=>{const t=Object.values(e.selected).every((e=>!0===e)),n=Object.values(e.selected).every((e=>!1===e));t?a("legendStateChange",!0):n&&a("legendStateChange",!1)})),r.on("updateAxisPointer",(function(t){const a=e.option?.series?.filter((e=>"pie"!==e.type))||[],n=t.axesInfo?.[0];if(!n)return;const l=n.value,o=e.pieConfig;o?.enabled&&Array.isArray(o.pies)&&o?.pies.forEach(((e,t)=>{const n=a.filter((t=>e.triggerZbCodes.includes(t.zbCode))),o=n.map((e=>{const t=Array.isArray(e.data)?e.data[l]:0;return{name:e.name,value:t}}));r.setOption({series:[{id:`pie_${t}`,data:o,label:{formatter:e=>`${e.name}\n ${e.value} \n(${e.percent}%)`}}]})}))})),o||(o=(0,x.A)((()=>{r&&!r.isDisposed()&&r.resize()}),200),window.addEventListener("resize",o));const i=performance.now();D.v.debug(`[Chart ${e.chartId}] 图表初始化耗时: ${Math.round(i-t)}ms`)},s=e=>{r&&!r.isDisposed()?e?.series?.length&&(D.v.debug("updateChart方法调用"),r.setOption(e,!1,!0)):i()},c=t=>{if(!r)return;const a=r.getOption().legend?.[0]?.data||[],n=performance.now();a.forEach((e=>{r.dispatchAction({type:t?"legendSelect":"legendUnSelect",name:e})}));const l=performance.now();D.v.debug(`[Chart ${e.chartId}] toggleAllLegends耗时: ${Math.round(l-n)}ms`)};return(0,n.sV)((()=>{(0,n.dY)((()=>i()))})),(0,n.wB)((()=>e.option),s,{deep:!1}),(0,n.xo)((()=>{o&&(window.removeEventListener("resize",o),o.cancel()),r?.dispose(),r=null})),t({toggleAllLegends:c}),{chartContainer:l}}},X=a(1241);const B=(0,X.A)(H,[["render",T],["__scopeId","data-v-2ce49885"]]);var W=B,$=a(5e3),F={name:"ChartContainer",components:{ChartView:W},props:{chart:{type:Object,required:!0},returnData:{type:Object,required:!0,default:()=>({})},config:{type:Object,default:()=>({})},viewMode:{type:String,default:"monthly"}},setup(e){const t=(0,A.KR)("bar"),a=(0,A.KR)(!1),l=(0,A.KR)(10),r=(0,A.KR)(!0),o=(0,A.KR)(null),i=(0,A.KR)(null),s=(0,A.KR)(0),c=(0,A.KR)([]),d=(0,n.EW)((()=>c.value)),u=(0,n.EW)((()=>{const n={data:e.returnData,title:e.chart.title||"默认标题",subtitle:e.chart.subtitle||"",zbcodeArr:e.chart.zbcodeArr||[],cityCodeArr:e.config.cityCodeArr||[],dbCode:e.chart.dbCode||"nd",unit:e.chart.unit||"",exceptName:e.chart.exceptName||"",legendTop:e.chart.legendTop,gridTop:e.chart.gridTop,chartType:t.value,yearLimit:l.value,isHorizontal:a.value,enableBirthOffset:e.chart.enableBirthOffset||!1,enableBirthPrediction:e.chart.enableBirthPrediction||!1,selectedLegend:i.value,offsetValue:s.value,pieConfig:e.chart.pieConfig},r=(0,$.HM)(n);return r})),h=(0,A.KR)(window.innerWidth),g=(0,n.EW)((()=>h.value>768?600:400)),p=(0,n.EW)((()=>e.chart.pieConfig?.enabled?h.value>768?150:100:0)),v=(0,n.EW)((()=>g.value+p.value));D.v.debug("当前的高度",v,p),(0,n.wB)(u,(async e=>{c.value=e?.legend?.data||[],!i.value&&c.value.length>0&&(i.value=c.value[0])}),{immediate:!0});const f=(e,n)=>{t.value=e,a.value=n},C=()=>{D.v.debug("一键全选:",r.value),r.value=!r.value,o.value&&o.value.toggleAllLegends(r.value)};return{currentChartType:t,isHorizontal:a,yearLimit:l,legendAllSelected:r,chartOption:u,setChartType:f,toggleAllLegends:C,chartRef:o,selectedLegend:i,offsetValue:s,legendList:d,chartHeight:v}}};const U=(0,X.A)(F,[["render",k],["__scopeId","data-v-09a8f2e6"]]);var q=U,P={components:{ChartContainer:q},props:{chartMetaList:Array,returnData:Object,config:Object,showToggles:{type:Boolean,default:!0}},data(){return{viewMode:"monthly"}},computed:{internalShowToggles(){if(!this.showToggles)return!1;const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")&&e.has("nd")},defaultViewMode(){const e=new Set(this.chartMetaList.map((e=>e.dbCode)));return e.has("yd")?"monthly":e.has("nd")?"yearly":"monthly"},filteredCharts(){return this.internalShowToggles?this.chartMetaList.filter((e=>"monthly"===this.viewMode?"yd"===e.dbCode:"nd"===e.dbCode)):this.chartMetaList},chartsToRender(){return this.filteredCharts.filter((e=>{const t=this.returnData?.sj?.[e.dbCode];return Array.isArray(t)&&t.length>0}))}},created(){this.viewMode=this.defaultViewMode}};const Q=(0,X.A)(P,[["render",s],["__scopeId","data-v-4658eebb"]]);var N=Q}}]);
//# sourceMappingURL=5410.03017c1b.js.map